\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{mathtools, amssymb, amsthm}
\usepackage{fullpage}
\usepackage{comment}
\usepackage{siunitx}

\usepackage[
    pdfusetitle,
    colorlinks
]{hyperref}

\title{Modeling and simulation of the SLM process}
\date{\today}
\author{Oleg Rogozin}

% general
\newcommand{\dd}{\mathrm{d}}
\newcommand{\der}[2][]{\frac{\dd#1}{\dd#2}}
\newcommand{\Der}[2][]{\dd#1/\dd#2}
\newcommand{\pder}[2][]{\frac{\partial#1}{\partial#2}}
\newcommand{\pderdual}[2][]{\frac{\partial^2#1}{\partial#2^2}}
\newcommand{\pderder}[3][]{\frac{\partial^2#1}{\partial#2\partial#3}}
\newcommand{\Pder}[2][]{\partial#1/\partial#2}
\newcommand{\Pderdual}[2][]{\partial^2#1/\partial#2^2}
\newcommand{\Pderder}[3][]{\partial^2#1/\partial#2\partial#3}
\newcommand{\dder}[2][]{\Delta_{#2}#1}
\DeclarePairedDelimiter\autobracket()       % mathtools are needed
\newcommand{\br}[1]{\autobracket*{#1}}
\newcommand{\OO}[1]{O(#1)}
\newcommand{\pert}[1]{\delta#1}
\newcommand{\diag}[1]{\left(#1\right)^\mathrm{diag}}

% topic-specific
\newcommand{\fusion}[1]{{#1}^\mathrm{fus}}

\begin{document}
\maketitle
\tableofcontents

\section{Formulation of the problem}

%%% The first law of thermodynamics
The conservation of energy for a substance at rest is described by the \(D\)-dimensional heat-conduction equation
\begin{equation}\label{eq:heat_conduction}
	\rho\pder[h(T)]{t} = \pder{x_i}\br{ k(\psi,T)\pder[T]{x_i} },
\end{equation}
where \(x_i\) are the physical coordinates (\si{m}), \(t\) is the time (\si{s}),
\(\rho\) is the density (\si{kg/m}\(^D\)), \(h\) is the specific enthalpy (\si{J/kg}),
\(T\) is the temperature (\si{\K}), \(k\) is the thermal conductivity (\si{W/Km}\(^{D-2}\)),
\(\psi\) is the porosity. Let
\begin{equation}\label{eq:porosity_variables}
	\rho = \rho_0(1-\psi_0), \quad k = k_0(T)(1-\psi),
\end{equation}
where \(\rho_0\) and \(k_0\) is the density and thermal conductivity of the bulk material, respectively,
\(\psi_0\) is the initial porosity.

%%% Introduce a liquid fraction
To incorporate the fusion process into the model, let the enthalpy depends on the temperature as follows:
\begin{equation}\label{eq:enthalpy}
	h = \int_{T_0}^T c_p(\xi)\dd\xi + \fusion{h}\phi(h),
\end{equation}
where \(c_p\) is the specific heat capacity (\si{J/kgK}), \(\fusion{h}\) is the specific enthalpy of fusion (\si{J/kg}),
\(\phi\) is the liquid fraction (\(0 \leq \phi \leq 1\)).
\(\phi=0\) and \(\phi=1\) corresponds to the solid and liquid states, respectively.
Substituting~\eqref{eq:porosity_variables} and~\eqref{eq:enthalpy} into~\eqref{eq:heat_conduction}, we obtain
\begin{equation}\label{eq:heat_conduction2}
	\rho_0\pder[h]{t} = \pder{x_i}\br{ \frac{1-\psi}{1-\psi_0} \frac{k_0(T)}{c_p(T)}\pder[h_*]{x_i} },
\end{equation}
where \(h_* = h - \fusion{h}\phi\) is introduced for convenience.

%%% Change in thermophysical properties resulting from fusion process
The phase transition results in an abrupt change in the thermophysical properties \(f=c_p,k_0\) of the material;
therefore, they can be expressed as
\begin{equation}\label{eq:fusion_change}
	f = f_S(T) + \br{ f_L(T) - f_S(T)}\phi,
\end{equation}
where \(f_S\) and \(f_L\) correspond to solid and liquid properties.
The porosity change is irreversible in time:
\begin{equation}\label{eq:porosity}
	\psi(t) = \psi_0\min_{0\leq\tau\leq t}\br{ 1-\phi(h(\tau)) }.
\end{equation}

%%% Initial and boundary conditions
Consider a half-space problem \(x_D<0\) with the following boundary condition at \(x_D=0\):
\begin{equation}\label{eq:bc}
	k(\psi,T)\pder[T]{x_D} = \frac{A(\psi)P}{(\pi R^2)^{(D-1)/2}}\exp\br{ -\frac{(x_i-x_{Bi}(t))^2}{R^2} }
	    - \alpha(T-T_0) - \epsilon\sigma T^{D+1},
\end{equation}
where \(A\) is the absorptivity, \(P\) is the laser power (\si{W}), \(R\) is the radius of the laser beam (\si{m}),
\(x_{Bi}\) are the coordinates of its center (\si{m}), \(\alpha\) is the convective heat transfer coefficient (\si{W/Km}\(^{D-1}\)),
\(\epsilon\) is the emissivity, \(\sigma\) is the Stefan--Boltzmann constant (\si{W/K}\(^{D+1}\)\si{m}\(^{D-1}\)).
The initial condition is \(T=T_0\) at \(t=0\).

\subsection{Dimensionless expressions}

Introduce the following dimensionless variables:
\begin{equation}\label{eq:dimensionless}
    \begin{aligned}
        x_i &= \hat{x}_iR, & t &= \hat{t}t_0, & h &= \hat{h}c_p(T_0)\Delta{T}, & T - T_0 &= \hat{T}\Delta{T}, \\
        P &= \hat{P} k_0(T_0)\Delta{T}R^{D-2}, & \alpha &= \hat{\alpha}\frac{k_0(T_0)}R, &
            \sigma &= \hat{\sigma}\frac{k_0(T_0)}{R\Delta{T}^D}, & T_0 &= \hat{T}_0\Delta{T}, \\
    \end{aligned}
\end{equation}
where \(t_0 = \rho_0 c_p(T_0) R^2/k_0(T_0)\) is the diffusive time scale at \(T=T_0\),
\(\Delta{T} = (T_S+T_L)/2 - T_0\) is the unit temperature.
If \(|\Pder[x_{Bi}]{t}|\) is of order \(U_0\), where \(U_0\) is the reference scanning speed (\si{m/s}),
then \(R/U_0\) is the convective time scale. Also denote
\begin{equation}\label{eq:dimensionless2}
    \hat{c}_p(\hat{T}) = \frac{c_p(T)}{c_p(T_0)}, \quad
    \hat{k}_0(\hat{T}) = \frac{k_0(T)}{k_0(T_0)}, \quad
    \hat{\phi}(\hat{h}) = \phi(h), \quad
    \hat{\psi}(\hat{h}) = \psi(h).
\end{equation}
Then~\eqref{eq:enthalpy},~\eqref{eq:heat_conduction2}, and~\eqref{eq:bc} take the following nondimensional form:
\begin{gather}
	\hat{h}_* \equiv \hat{h} - \fusion{\hat{h}}\hat{\phi} = \int_0^{\hat{T}} \hat{c}_p(\xi)\dd\xi, \label{eq:enthalpy_hats} \\
	\pder[\hat{h}]{\hat{t}} = \pder{\hat{x}_i}\br{
	    \frac{1-\hat{\psi}}{1-\psi_0}
	    \frac{\hat{k}_0(\hat{T})}{\hat{c}_p(\hat{T})}\pder[\hat{h}_*]{\hat{x}_i}
	}, \label{eq:heat_conduction_hats} \\
	\br{1 - \hat{\psi}} \frac{\hat{k}_0(\hat{T})}{\hat{c}_p(\hat{T})}\pder[\hat{h}_*]{\hat{x}_D} +
	    \hat{\alpha}\hat{T} + \epsilon\hat{\sigma} \br{ \hat{T} + \hat{T}_0 }^{D+1} =
	    \frac{A(\psi)\hat{P}}{\pi^{(D-1)/2}}\exp\br{ -\br{ \hat{x}_i-\hat{x}_{Bi}(t) }^2 }. \label{eq:bc_hats}
\end{gather}
The initial condition is \(\hat{h} = 0\).

\subsection{Thermophysical properties}

For conventional materials, the required thermophysical properties can be reasonably approximated by the three-parameter model
\begin{equation}\label{eq:thermophysical_model}
	\hat{f} = 1 + \hat{f}'_S\hat{T} + \left[
	    \fusion{\hat{f}} + \br{ \hat{f}'_L - \hat{f}'_S }\br{ \hat{T}-1 }
	\right]\hat{\phi},
\end{equation}
where \(\hat{f}'_{S,L}\) are the corresponding constant first temperature derivatives far from fusion process,
\(\fusion{\hat{f}}\) is the property jump at the phase transition.

% TODO: supplement the proposed model by a figure.

\section{Liquid fraction models}

Impose the following physical requirements upon \(\hat\phi(\hat{h})\):
\begin{gather}
    0 \leq \der[\hat\phi]{\hat{h}} \leq \left.\der[\hat\phi]{\hat{h}}\right|_{\hat{h}=\hat{h}(1)} =
        \frac1{\hat{h}_L-\hat{h}_S}, \label{eq:lf_monotonic}\\
	\phi(\hat{h}<\hat{h}_S) = \OO{(\hat{h}_S-\hat{h})^{-\infty}}, \quad
	    \phi(\hat{h}>\hat{h}_L) = \OO{(\hat{h}-\hat{h}_L)^{-\infty}}, \label{eq:lf_exp_decay}
\end{gather}
where \(\hat{h}_S = \hat{h}(\hat{T}_S)\) and \(\hat{h}_L = \hat{h}(\hat{T}_L)\).
\(\hat{T}_S\) and \(\hat{T}_L\) are the solidus and liquidus temperatures, respectively.

The simplest \(\mathcal{C}^0\) model for \(\hat{\phi}(\hat{h})\) can be constructed as a piecewise approximation
\begin{equation}\label{eq:lf_piecewise}
	\hat{\phi} = \begin{cases}
        0,                                             & \hat{h} \leq \hat{h}_S, \\
        \frac{\hat{h}-\hat{h}_S}{\hat{h}_L-\hat{h}_S}, & \hat{h}_S < \hat{h} < \hat{h}_L, \\
        1,                                             & \hat{h}_L \leq \hat{h}.
    \end{cases}
\end{equation}
Except \(\fusion{\hat{h}}\), \(\delta\fusion{\hat{T}} = \hat{T}_L - \hat{T}_S\)
is the only parameter of the fusion process  used in~\eqref{eq:lf_piecewise}.
Employing cubic splines near \(h_S\) and \(h_L\) yields the more realistic two-parameter \(\mathcal{C}^1\) model:
\begin{equation}\label{eq:lf_splines}
	\dots
\end{equation}

\section{Temperature evaluation}

For arbitrary \(\hat{\phi}(\hat{h})\), solution of~\eqref{eq:enthalpy_hats} is not straightforward.
However, the temperature is included in~\eqref{eq:heat_conduction_hats} only through thermophysical properties
and, therefore, can be evaluated quite roughly.
Direct dependence of boundary conditions~\eqref{eq:bc_hats} on temperature is also weak.
Several approaches can be proposed to find a simplified approximation of \(\hat{T}(\hat{h})\).

\subsection{\(\mathcal{C}^1\) approximation}

\begin{table}[ht]
    \centering
    \caption{Piecewise quantities for~\eqref{eq:temp_crude}}
    \label{table:temp_params}
    \begin{tabular}{c|cccc}
        \hline\\[-1em]
        \(\hat{h}\)                         & \(\hat{c}'_p\)    & \(\hat{c}_{p0}\)  & \(\hat{T}^\dag\) & \(\hat{h}^\dag\) \\[0.3em]
        \hline\\[-1em]
        \(\hat{h} \leq \hat{h}_S\)          & \(\hat{c}'_{pS}\) & \(1\)             & \(0\)            & \(0\)            \\[0.3em]
        \(\hat{h}_S < \hat{h} < \hat{h}_L\) & \(a\)             & \(b\)             & \(\hat{T}_S\)    & \(\hat{h}_1\)    \\[0.3em]
        \(\hat{h}_L \leq \hat{h}\)          & \(\hat{c}'_{pL}\) & \(\hat{c}_{pL0}\) & \(\hat{T}_L\)    & \(\hat{h}_2\)    \\[0.3em]
        \hline
    \end{tabular}
\end{table}

An acceptable accuracy can be achieved if the heat capacity is assumed
to depend on temperature linearly during a fusion process, i.e.,
\begin{equation}\label{eq:cp_crude}
	\hat{c}_p = \begin{cases}
        1 + \hat{c}'_{pS}\hat{T},             & \quad \hat{h} \leq \hat{h}_S, \\
        b + a\hat{T},                         & \quad \hat{h}_S < \hat{h} < \hat{h}_L, \\
        \hat{c}_{pL0} + \hat{c}'_{pL}\hat{T}, & \quad \hat{h}_L \leq \hat{h},
    \end{cases}
\end{equation}
where
\begin{equation*}
	\hat{c}_{pL0} = 1 + \fusion{\hat{c}_p} + \hat{c}'_{pS} - \hat{c}'_{pL}, \quad
	a = \frac{\hat{c}'_{pS} + \hat{c}'_{pL}}2 + \frac{\fusion{\hat{c}_p}}{\delta\fusion{\hat{T}}}, \quad
	b = 1 + \hat{T}_S\br{ \hat{c}'_{pS} - a }.
\end{equation*}
Substituting~\eqref{eq:cp_crude} into~\eqref{eq:enthalpy_hats},
we obtain that the temperature is calculated as a root of the quadratic equation
\begin{equation}\label{eq:temp_crude}
	\hat{T} = \hat{T}^\dag + \frac{\sqrt{\hat{c}_{p0}^2 + 2\hat{c}_p'(\hat{h}_* - \hat{h}^\dag) } - \hat{c}_{p0}}{\hat{c}'_p},
\end{equation}
with the piecewise quantities defined in Tab.~\ref{table:temp_params}. Finally,
\begin{equation}\label{eq:enthalpySL_crude}
	\hat{h}_S = \fusion{\hat{h}}\hat{\phi}_S + \hat{h}_1, \quad \hat{h}_L = \fusion{\hat{h}}\hat{\phi}_L + \hat{h}_1 + \hat{h}_2,
\end{equation}
where \(\hat{\phi}_{S,L} = \hat{\phi}(\hat{h}(\hat{T}_{S,L}))\) and
\begin{equation*}
	\hat{h}_1 = \hat{T}_S\br{ 1 + \frac{\hat{c}'_{pS}}2\hat{T}_S }, \quad
	\hat{h}_2 = \delta\fusion{\hat{T}}\br{ b + \frac{a}2\delta\fusion{\hat{T}} }.
\end{equation*}

%%% Smoothness of c_p
Note that \(\Der[\hat{c}_p]{\hat{h}}\in\mathcal{C}^1\)
only if \(\hat{\phi}(\hat{h})\in\mathcal{C}^1\) and \(\hat{c}_p\in\mathcal{C}^0\).
Therefore, using \(\mathcal{C}^1\) model~\eqref{eq:lf_splines} for calculating \(\hat{c}_p(\hat{T})\)
and \(\mathcal{C}^0\) model~\eqref{eq:cp_crude} for calculating \(\hat{T}\)
ensure that \(\Der[\hat{c}_p]{\hat{h}}\in\mathcal{C}^1\).

%%% Simple case
If \(\hat{c}'_{pL} = \hat{c}'_{pS} = \hat{c}'_p\) and \(\fusion{\hat{c}_{p}} = 0\),
then~\eqref{eq:temp_crude} can be rewritten as
\begin{equation}\label{eq:temp_crude2}
	\hat{T} = \frac{\sqrt{1+2\hat{c}_p'\hat{h}_*}-1}{\hat{c}_p'}
\end{equation}
when \(\hat{c}_p'>0\) and \(\hat{T} = \hat{h}_*\) when \(\hat{c}_p'=0\).

\subsection{\(\hat\phi\)-based approximation}

Another way is to use~\eqref{eq:fusion_change} for \(f=h\) with the five-parameter model:
\begin{equation}\label{eq:enthalpy_phi}
	\hat{h} = \hat{h}'_S\hat{T} + \frac{\hat{h}''_S}2\hat{T}^2 + \left[
	    \fusion{\hat{h}} + \br{ \hat{h}'_L - \hat{h}'_S }\br{ \hat{T}-1 } +
	    \frac{\hat{h}''_L - \hat{h}''_S}2\br{ \hat{T}^2-1 }
	\right]\hat{\phi},
\end{equation}
where
\begin{equation}\label{eq:enthalpy_phi_params}
	\hat{h}'_S = 1, \quad \hat{h}'_L = \fusion{\hat{c}}_p + \hat{c}'_{pS} - \hat{c}'_{pL}, \quad
	\hat{h}''_S = \hat{c}'_{pS}, \quad \hat{h}''_S = \hat{c}'_{pL}
\end{equation}
should be fulfilled for~\eqref{eq:enthalpy_phi} to be consistent with \(\hat{c}_p(\hat{T})\)
defined as~\eqref{eq:thermophysical_model}. Then,
\begin{equation}\label{eq:temp_phi}
	\hat{T} = \frac{\sqrt{\hat{h}'^2 + 2\hat{h}''\hat{h}_*}-\hat{h}'}{\hat{h}''},
\end{equation}
where \(\hat{h}^{\prime,\prime\prime} = \hat{h}_S^{\prime,\prime\prime} (1-\hat\phi) + \hat{h}_L^{\prime,\prime\prime}\hat\phi\).

\begin{comment}

For~\eqref{eq:heat_conduction_hats}, we can write
\begin{gather}
    F = \dder{\hat{x}_i}\br{
        \frac{1 - \hat{\psi}}{1 - \psi_0}
	    \frac{1 + \hat{k}'\hat{T}}{1 + 2\hat{c}_p'\hat{T}}
	    \dder[\hat{h}_*]{\hat{x}_i}
	}, \\
    \pert{F} = \dder{\hat{x}_i}\left[ \frac{1 - \hat{\psi}}{1 - \psi_0} \br{
	    \frac{(\hat{k}' - 2\hat{c}_p')\pert{\hat{h}_*}}{(1 + 2\hat{c}_p'\hat{T})^3}
	     \dder[\hat{h}_*]{\hat{x}_i}
	    +
	    \frac{1 + \hat{k}'\hat{T}}{1 + 2\hat{c}_p'\hat{T}}
	    \dder[\pert{\hat{h}_*}]{\hat{x}_i}
	}\right], \\
    \diag{\pert{F}} \approx \frac{1 - \hat{\psi}}{1 - \psi_0} \br{
	    \frac{\hat{k}' - 2\hat{c}_p'}{(1 + 2\hat{c}_p'\hat{T})^3} \dder[\hat{h}_*]{\hat{x}_i} \diag{\dder{\hat{x}_i}}
	    +
	    \frac{1 + \hat{k}'\hat{T}}{1 + 2\hat{c}_p'\hat{T}}
	    \diag{\dder{\hat{x}_i}^2}
	}\diag{\pert{\hat{h}_*}}.
\end{gather}
where
\begin{gather}
    \pert{\hat{h}_*} = \pert{\hat{h}} - \fusion{\hat{h}}\pert{\hat\phi}, \quad
    \diag{\hat{h}_*} = \diag{\pert{\hat{h}_*}} = 1 - \fusion{\hat{h}}\diag{\pert{\hat\phi}}, \\
	\pert{\hat{\phi}} = \begin{cases}
        0 & \quad \hat{h} \leq \hat{h}_S, \quad \hat{h}_L \leq \hat{h}, \\
        \pert{\hat{h}}/(\hat{h}_L-\hat{h}_S) & \quad \hat{h}_S < \hat{h} < \hat{h}_L, \\
    \end{cases} \label{eq:pert_phi_h}\\
	\diag{\pert{\hat{\phi}}} = \begin{cases}
        0 & \quad \hat{h} \leq \hat{h}_S, \quad \hat{h}_L \leq \hat{h}, \\
        1/(\hat{h}_L-\hat{h}_S) & \quad \hat{h}_S < \hat{h} < \hat{h}_L. \\
    \end{cases} \label{eq:pert_phi_h_diag}
\end{gather}

Nonlinear dependence~\eqref{eq:temperature} can be linearized; therefore, we have the following linear boundary condition at \(z=0\):
\begin{equation}\label{eq:bc_linearized}
	\br{ \hat{\alpha} + \frac{1 - \hat{\psi}^n}{1 - \psi_0}\br{ 1 + \hat{k}'\hat{T}^n }\pder{\hat{x}_3} }
	    \br{ \hat{T}^n + \frac{\hat{h}_* - \hat{h}_*^n}{1+2\hat{c}_p'\hat{T}^n} }
	    = \frac{A\hat{P}}{\pi}\exp\br{ -(\hat{x}_1-\hat{U}\hat{t}^n)^2 - \hat{x}_2^2 },
\end{equation}
where superscripts \(n\) and \(n+1\) correspond to the previous and current iterations, respectively.

\end{comment}

\end{document}

0 = T + c'T^2 + phi - h
T = (-1+\sqrt{1+4c'(h-phi)})/2c'
\psi = \psi_0 -- \phi=0
\psi = 0      -- \phi=1
\psi = \psi_0 - \phi\psi_0

