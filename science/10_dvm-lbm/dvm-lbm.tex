\documentclass{elsarticle} %review
\usepackage[english]{babel}

%%% functional packages
\usepackage{amssymb, mathtools, amsthm, mathrsfs}
\usepackage{subcaption}
\usepackage{graphicx}
\graphicspath{{_pics/}}

%%% configuration packages
\usepackage{fullpage}
\usepackage{comment}

\usepackage{xcolor}
\newcommand{\todo}[1]{\textcolor{olive}{#1}}
\newcommand{\alert}[1]{\textcolor{red}{\large \bf #1}}

% \usepackage{lineno}
% \modulolinenumbers[5]

\usepackage{hyperref}

\usepackage{tikz}
\usetikzlibrary{arrows, math, decorations.pathreplacing, calc}

\tikzset{
    >=latex',
    interface/.style={blue, very thick},
    boundary/.style={interface, postaction={draw, decorate, thick,
        decoration={border, angle=#1, amplitude=0.3cm, segment length=2mm, pre length=1mm}}},
    ghost/.style={fill=gray!50},
    eqref/.style={red},
    mapping/.style={eqref, dashed},
    bolddot/.style={shape=circle, fill=black, scale=0.5},
}

\journal{Journal of \LaTeX\ Templates}

%%%%%%%%%%%%%%%%%%%%%%%
%% Elsevier bibliography styles
%%%%%%%%%%%%%%%%%%%%%%%
%% To change the style, put a % in front of the second line of the current style and
%% remove the % from the second line of the style you would like to use.
%%%%%%%%%%%%%%%%%%%%%%%

%% Numbered
%\bibliographystyle{model1-num-names}

%% Numbered without titles
%\bibliographystyle{model1a-num-names}

%% Harvard
%\bibliographystyle{model2-names.bst}\biboptions{authoryear}

%% Vancouver numbered
%\usepackage{numcompress}\bibliographystyle{model3-num-names}

%% Vancouver name/year
%\usepackage{numcompress}\bibliographystyle{model4-names}\biboptions{authoryear}

%% APA style
%\bibliographystyle{model5-names}\biboptions{authoryear}

%% AMA style
%\usepackage{numcompress}\bibliographystyle{model6-num-names}

%% `Elsevier LaTeX' style
\bibliographystyle{elsarticle-num}
%%%%%%%%%%%%%%%%%%%%%%%

% general
%\newcommand{\Kn}{\mathrm{Kn}}
\newcommand{\Ma}{\mathrm{Ma}}
\newcommand{\dd}{\mathrm{d}}
\newcommand{\pder}[2][]{\frac{\partial#1}{\partial#2}}
\newcommand{\pderdual}[2][]{\frac{\partial^2#1}{\partial#2^2}}
\newcommand{\pderder}[3][]{\frac{\partial^2#1}{\partial#2\partial#3}}
\newcommand{\pderderder}[4][]{\frac{\partial^3#1}{\partial#2\partial#3\partial#4}}
\newcommand{\Pder}[2][]{\partial#1/\partial#2}
\newcommand{\Pderdual}[2][]{\partial^2#1/\partial#2^2}
\newcommand{\Pderder}[3][]{\partial^2#1/\partial#2\partial#3}
\newcommand{\Set}[2]{\{\,{#1}:{#2}\,\}}
\newcommand{\OO}[1]{O(#1)}
\newcommand{\transpose}[1]{#1^\mathsf{T}}
\DeclarePairedDelimiter\autobracket()       % mathtools are needed
\newcommand{\br}[1]{\autobracket*{#1}}

\DeclareMathOperator{\sgn}{sgn}

% topic-specific
\newcommand{\dxi}{\dd{\boldsymbol{\xi}}}
\newcommand{\bxi}{\boldsymbol{\xi}}
\newcommand{\bpsi}{\boldsymbol{\psi}}
\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bq}{\boldsymbol{q}}
\newcommand{\bc}{\boldsymbol{c}}
\newcommand{\bn}{\boldsymbol{n}}
\newcommand{\be}{\boldsymbol{e}}
\newcommand{\bm}{\boldsymbol{m}}
\newcommand{\bT}{\boldsymbol{T}}
\newcommand{\bdot}{\boldsymbol{\cdot}}
\newcommand{\dx}{\dd{\boldsymbol{x}}}
\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\equil}[1]{#1^\mathrm{(eq)}}
\newcommand{\hermite}[1]{#1^\mathrm{(H)}}
\newcommand{\NSF}[1]{#1^\mathrm{(NSF)}}
\newcommand{\refer}[1]{#1_0}
\newcommand{\LB}{\mathrm{LB}}
\newcommand{\DV}{\mathrm{DV}}
\newcommand{\Herm}{\mathcal{H}}
\newcommand{\cut}{{(\mathrm{cut})}}

\newcommand{\xiaj}{\xi_{\alpha,j}}
\newcommand{\xibj}{\xi_{\beta,j}}
\newcommand{\xigj}{\xi_{\gamma,j}}
\newcommand{\caj}{c_{\alpha,j}}
\newcommand{\cbj}{c_{\beta,j}}
\newcommand{\cgj}{c_{\gamma,j}}
\newcommand{\Aa}{a_{\alpha}}
\newcommand{\Aab}{a_{\alpha\beta}}
\newcommand{\Aabg}{a_{\alpha\beta\gamma}}
\newcommand{\Ha}{H_{\alpha}}
\newcommand{\Hab}{H_{\alpha\beta}}
\newcommand{\Habg}{H_{\alpha\beta\gamma}}
\newcommand{\xia}{\xi_{\alpha}}
\newcommand{\xib}{\xi_{\beta}}
\newcommand{\xig}{\xi_{\gamma}}

\begin{document}

\begin{frontmatter}

\title{Kinetic multiscale scheme based on the discrete-velocity and lattice-Boltzmann methods}

\author[ccas]{V.V.~Aristov}
\author[ccas]{O.V.~Ilyin}
\author[skoltech,ccas]{O.A.~Rogozin\corref{cor}}
\cortext[cor]{Corresponding author}
\ead{oleg.rogozin@phystech.edu}

\address[ccas]{Dorodnicyn Computing Center,
    Federal Research Center "Computer Science and Control" of Russian Academy of Science, Moscow, Russia}
\address[skoltech]{Center for Design, Manufacturing, and Materials,
    Skolkovo Institute of Science and Technology, Moscow, Russia}

\begin{abstract}

A novel hybrid computational method based on the discrete-velocity (DV) approximation including the lattice-Boltzmann (LB) technique is proposed.
Numerical schemes for the kinetic equations are used in regions of rarefied flows and LB schemes are employed in continuum flow zones.
The schemes are written under the finite-volume (FV) formulation to achieve flexibility of local mesh refinement.
The expansion to the Hermite polynomials is used for the coupling of DV and LB solutions.
Special attention is paid to the recent high-order and regularized LB models.
The linear Couette flow is analyzed as a numerical example,
where a good correspondence with the benchmark solutions is obtained.
% [POISEUILLE]: The linear Couette and Poiseuille flows are analyzed as numerical examples,


%In the present paper, a novel hybrid fluid--kinetic computational approach based on the discrete-velocity (DV) approximation including lattice-Boltzmann (LB) technique is proposed. Numerical schemes for a kinetic equation are used in regions of rarefied flows and LB schemes are used in continuum flow zones. The problem devoted to matching solutions of DV and LB in buffer cells is solved using the expansion of the solutions of DV and LB models on Hermite polynomials and matching the expansion coefficients. A special attention is paid to the recent high-order LB models. Some variants of LBM are considered and the efficiency of the hybrid method is evaluated. The Couette-flow problem is investigated as a test. The criteria transformation from the continuum region to kinetic one is proposed and the influence of the point transformation is studied. The CPU times for the hybrid scheme and for BGK scheme are compared. The good correspondence with the benchmark solution is obtained: the computations on the basis of the hybrid method are close to the well-known tabulated solutions of the Couette flow.




\end{abstract}

\begin{keyword}
%kinetic--kinetic coupling,
%kinetic multiscale scheme,
hybrid numerical method,
discrete-velocity method,
lattice-Boltzmann method,
domain decomposition,
Knudsen layer.
\end{keyword}

\end{frontmatter}

% \linenumbers
\tableofcontents

\section{Introduction}\label{sec:intro}

%%% Effective numerical methods for multiscale problems
Thus far, effective numerical simulation of multiscale flows has remained a challenging problem despite the efforts of many researchers.
This is due, in particular, to complicated flow structures where small-scale highly nonequilibrium regions
coexist with large-scale equilibrium zones.
The use of the kinetic equation in all regions is very demanding from a computational point of view.
On the other hand, the computational fluid dynamics provide an efficient description of near-equilibrium flows,
but it is not adequate for regions where the velocity distribution function (VDF) is not close to Maxwellian
and the contribution of highest moments cannot be ignored.
% Therefore, computational fluid dynamics is being confronted with the challenge of constructing the unified numerical methods suitable for simulation of multiscale flows.
% The numerical solution of kinetic equations in stiff regimes represents a challenge in the construction of computational methods.
% one would like to avoid the expensive cost of solving the kinetic equation in regions well described by continuum fluid models,
% since the latter are easily solvable by classical numerical methods.
% Therefore, to strike a balance between computational costs and simulation accuracy,
% multiscale schemes are being developed that take advantage of both kinetic and continuum-fluid solvers,
% i.e., deploying a kinetic solver only in the rarefied flow regions and a continuum solver in the hydrodynamic regions.

%%% Hybrid schemes
There are two main approaches how to deal with the multiscale problems (see, e.g., review~\cite{Dimarco2014}).
The first one employs different kinds of representations for equilibrium and nonequilibrium parts of the solution
in the entire computational space, while the second one handles the problem by dividing the physical domain
into the highly rarefied and near-equilibrium regions using some criterion of domain decomposition.
The fluid--kinetic coupling is a natural and effective approach for the description of multiscale flows.
The coupling of the Boltzmann and Euler or Navier--Stokes (NS) equations
is a canonical example of such hybrid schemes (see, e.g.,~\cite{Bourgat1996, Tallec1997}).
%and has also been elaborated and applied within the Unified Flow Solver (UFS)~\cite{Kolobov2007}.
%1. Asymptotic-preserving schemes
%2. Dynamic domain decomposition strategies
%    A. Dynamic fluid--kinetic coupling methods:
%        a) A moving interface method: a stationary smooth transition strategy was proposed for this coupling.
%        b) A micro–macro moving interface method (Degond et al. 2010): micro–macro decomposition of the VDF
%3. Hybrid methods
%    A. Low-variance deviational Monte Carlo methods
%    % Variance reduction methods are a popular way to improve the accuracy of Monte Carlo methods by reducing the amount of fluctuations in the results (Caflisch 1998).
%    B. Moment-guided Monte Carlo methods
%    % The basic idea described here consists in obtaining reduced-variance Monte Carlo methods by forcing the statistical samples to match prescribed sets of moments given by the solution of deterministic macroscopic fluid equations (Degond et al. 2011, Dimarco 2013).
%    C. Hybrid multiscale methods (hybrid representation of the solution)
%    % different kind of representation of the solution as an equilibrium and nonequilibrium part, first introduced in Pareschi and Caflisch (1999).
%    % the solution in each cell is represented as a combination of two different parts, a stochastic particle representation of the nonequilibrium fraction and a deterministic representation of the equilibrium part

%%% Kinetic-based description of continuum media
We briefly consider the development and realization of these essential ideas.
The kinetic-based description of continuum media has been suggested independently and has been widely used since the beginning of 80s,
see~\cite{Potkin1975, Pullin1980, Reitz1981, Aristov1983}. Later these kinetic-consistent schemes have been developed
in~\cite{Elizarova1985, Deshpande1986, Prendergast1993, Chou1997, Ohwada2004Xu, Ohwada2004Kobayashi, Ohwada2006}.
Such methods reproduce the Euler and NS dynamics.
The cellular-automata approximation for the NS equations was developed in the middle of 80s~\cite{Frisch1986}.
Finally, the lattice-gas model based on the BGK equation was proposed in the beginning of 90s~\cite{Qian1992}.
It gave rise to a wide class of numerical methods called lattice-Boltzmann (LB) methods~\cite{Higuera1989,Benzi1992,Succi2001}.
%%% Ilyin: Succi citation
The DV models of LB type, which correctly describe the hydrodynamic and non-hydrodynamic moments
up to the Burnett level, were considered in~\cite{Xu2018, Xu2019}.

%%% Connection between DV and LB
It is worth emphasizing that there is a fundamental relationship between the LB and DV methods.
For instance, one can cite a phrase from~\cite{Rivet2001}:
``This type of discrete kinetic theory can be seen as the ancestor of the lattice gas approach.''
The LB method is genetically related to the Broadwell-type models~\cite{Broadwell1964shock, Gatignol1975},
which use a small number of discrete velocities to reproduce some relevant features of the Boltzmann equation.
Thus, the DV approximation is a natural basis for construction of a hybrid multiscale model.

%%% Known coupling schemes for LB
The mapping scheme for coupling the low-order and high-order LB models is presented in~\cite{Meng2011},
while the possibility of merging the DV and LB methods was noticed in~\cite{Succi2016}.
The methods of DSMC type in the kinetic zones and the Euler or NS equations in the continuum are well developed by now,
but the usual statistical modeling in the buffer zone yields some statistical noise especially for subsonic flows,
which complicates calculations.
This hybrid approach has been suggested in~\cite{Staso2016short, Staso2016long} and in the recent paper~\cite{Staso2018},
where the solution is obtained by means of coupling the DSMC and LB methods.
The first results on coupling of the LB an DV models for the one-dimensional case
based on matching of the half-fluxes have been presented in~\cite{Ilyin2018}.

%%% Why DV is better than DSMC?
Unlike DSMC, the methods of direct numerical solution of the Boltzmann equation do not give statistical noise of macroscopic parameters.
Therefore, hybrid approaches based on them appear to be more promising.
The DV schemes with the large number of discrete velocities are used in direct methods for solving BE, BGK, S-model or other kinetic equations.
The DV method is applied with the combination of Monte Carlo or quasi-Monte Carlo procedures for evaluating collision integrals
and for computing the appropriate moments which are used in the collision integrals of the model kinetic equations.
For the near-equilibrium zones, the small number of discrete velocities can be considered.
Therefore, one can expect that LB approaches are fit for describing flows in these regions.

%%% Our proposition
A novel hybrid kinetic approach for multiscale problems is proposed in this paper.
We attempt to couple the DV method for the Boltzmann equation (or its BGK model)
and the LB method for the NS and fluid-dynamic-type equations beyond.
The DV method adequately describes nonequilibrium regions, while the LB one provides an adequate description in continuum regions.
To couple solutions between the DV and LB subdomains, we approximate the VDF by the truncated Hermite expansion in the buffer zone.
The high-order LB models~\cite{Shan2006, Feuchter2016}
% [POISEUILLE]: as well as the special regularization procedures~\cite{Latt2006, Mont2015}
are used to expand the continuum subdomain.

%%% FV formulation
The classical LB methods enjoy their efficiency as a result of highly symmetric discrete physical space and time.
However, uniform Cartesian meshes lack flexibility and, therefore, local mesh refinement.
There are several approaches how to work around this limitation.
The LB method is easily extended for arbitrary unstructured meshes
under the FV formulation~\cite{Succi1992, Peng1999, Patil2009, Li2016}.
In the present paper, this strategy is adopted, specifically to refine mesh near the boundary.

%%% Plan of the paper
The plan of the present paper is as follows.
The governing equations and nondimensional variables are introduced in Section~\ref{sec:equations}.
The mapping scheme is described in Section~\ref{sec:mapping}.
Details of the numerical methods used are presented in Section~\ref{sec:numerics}.
Section~\ref{sec:results} contains the numerical solutions of the Couette-flow problems, % [POISEUILLE]: Poiseuille-flow
obtained by the DV model, various LB models, and the proposed hybrid scheme,
as well as a discussion on the computational efficiency of the hybrid approach.
In section~\ref{sec:summary}, perspectives of the kinetic multiscale DV-LB methods are outlined.

\section{Main equations}\label{sec:equations}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% [Rogozin]: there should be nothing about Couette flow, discretization, methods, and algorithms in "Main equations"!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Nondimensional variables
We first introduce the notation for describing a dilute gas.
Let \(L\), \(\refer\rho\), \(\refer{T}\), \(\refer{c} = \sqrt{R\refer{T}}\) and \(\refer{p} = \refer{\rho}R\refer{T}\) be
the reference length, density, temperature, velocity, and pressure, respectively.
The specific gas constant \(R = k_B/m\), where \(k_B\) is the Boltzmann constant and \(m\) is the molar mass.
Then, \(f\refer{\rho}/\refer{c}^3\) is the one-particle velocity distribution function (VDF)
defined in seven-dimensional space \((tL/\refer{c}, \bx L, \bxi \refer{c})\) and
the macroscopic variables take the following form:
\(\rho\refer{\rho}\) is the density, \(\bv\refer{c}\) is the velocity, \(T\refer{T}\) is the temperature,
\(p_{\alpha\beta}\refer{p}\) is the stress tensor, \(\bq\refer{p}\refer{c}\) is the heat flux.
In the dimensionless form, they are calculated as polynomial moments of the VDF:
\begin{equation}\label{eq:macro}
    \begin{gathered}
    \rho = \int f \dxi, \quad
    \bv = \frac1{\rho} \int \bxi f \dxi, \quad
    T = \frac{1}{3\rho}\int|\bxi-\bv|^2f \dxi = \frac{p_{\alpha\alpha}}{3\rho}, \\
    p_{\alpha\beta} = \int(\xi_\alpha - v_\alpha)(\xi_\beta - v_\beta) f \dxi, \quad
    \bq = \frac12\int(\bxi-\bv)|\bxi-\bv|^2 f \dxi.
    \end{gathered}
\end{equation}
Integration with respect to \(\bxi\) is, hereafter, carried out over \(\mathbb{R}^3\).

%%% Boltzmann equation
The VDF is governed by the Boltzmann equation
\begin{equation}\label{eq:Boltzmann}
    \pder[f]{t} + \bxi\bdot\pder[f]{\bx} = \frac{1}{\tau} J(f),
\end{equation}
where \(J(f)\) is the collisional operator with a local Maxwellian as the equilibrium function
\begin{equation}\label{eq:equilibrium}
    \equil{f}\br{\bxi; \rho, \bv, T} = \frac{\rho}{(2\pi T)^{3/2}}\exp\br{-\frac{|\bxi-\bv|^2}{2T}}.
\end{equation}
The characteristic relaxation time of collisions to equilibrium \(\tau\)
can be expressed in terms of the reference gas viscosity \(\refer\mu\)~\cite{Cercignani2000, Sone2007},
\begin{equation}\label{eq:tau}
    \tau = \frac{\refer\mu\refer{c}}{\refer{p}L},
\end{equation}
and is related to the modified Knudsen number \(k=\ell_0\sqrt\pi/2L\), where \(\ell_0\) is the mean free path,
as \(\tau = k / \sqrt2\).

%%% BGK equation
In the present paper, we restrict ourselves to the simplest relaxation model~\cite{Krook1954, Welander1954}
\begin{equation}\label{eq:bgk_integral}
    J(f)(\bxi) = \rho\br{\equil{f}(\bxi) - f(\bxi)},
\end{equation}
often referred as the Bhatnagar--Gross--Krook (BGK) model of the Boltzmann collisional operator.
The nonlinearity in~\eqref{eq:bgk_integral} is more severe in comparison to the full Boltzmann equation
since \(\equil{f}\) depends on \(f\) via its moments,
but the BGK model is much simpler from the numerical point of view.

%%% Boundary conditions
The gas--surface interaction is modeled via the diffuse-reflection boundary condition:
\begin{equation}\label{eq:diffuse}
    f(t,\bx_B,\bxi) = \equil{f} \br{ \bxi;
        -\sqrt\frac{2\pi}{T_B} \int_{\bxi'\bdot\bn<0} \br{ \bxi'\bdot\bn } f(t,\bx_B,\bxi')\dxi', \bv_B, T_B
    } \quad (\bxi\bdot\bn>0),
\end{equation}
where \(\bn\) is the unit vector normal to the boundary, directed into gas,
\(\bx_B\), \(T_B\), and \(\bv_B\) are the boundary coordinates, temperature, and velocity, respectively.
It is also assumed that \(\bv_B\bdot\bn = 0\).

\section{Discrete-velocity approximation}\label{sec:dv}

%%% Discretization of the velocity space
Within the DV framework, the admissible particle velocities
are restricted to the discrete set \(\Set{\bxi_j}{j=1,\dots,N}\).
Under this assumption, an arbitrary moment \(\phi(\bxi)\) of \(f\), including~\eqref{eq:macro},
is approximated as
\begin{equation}\label{eq:cubature}
    \int \phi f\dxi = \sum_{j=1}^{N} \phi(\bxi_j) f_j,
\end{equation}
where \(f_j/w_j\) is an approximation of \(f(\bxi_j)\), \(w_j\) is a quadrature weight.
The evolution of \(f_j\) is governed by the system of partial differential equations
\begin{equation}\label{eq:dvm}
    \pder[f_j]{t} + \bxi_j\bdot\pder[f_j]{\bx} = \frac{1}{\tau} J_N(f_j)
\end{equation}
which is called the DV model of~\eqref{eq:Boltzmann}~\cite{Cabannes1980}.
The \emph{DV method} of solving~\eqref{eq:Boltzmann} is based on a DV model,
which is consistent with~\eqref{eq:Boltzmann} when \(N\) goes to infinity~\cite{Aristov2001}.

%%% Conservative and entropic properties
It is important for a DV model~\eqref{eq:dvm} to preserve conservation and entropy properties
of the continuous kinetic equation~\eqref{eq:Boltzmann}.
For the BGK model
\begin{equation}\label{eq:dvm-bgk}
    J_N(f_j) = \rho\br{\equil{f}_j-f_j},
\end{equation}
it can be accomplished when the discrete local equilibrium \(\equil{f}_j\) has the Maxwellian form
\begin{equation}\label{eq:equilibrium-bgk}
    \equil{f}_{\DV,j}(\hat\bm) = \frac{\hat\rho w_{\DV,j}}{(2\pi \hat{T})^{3/2}}
        \exp\br{-\frac{|\bxi_{\DV,j}-\hat\bv|^2}{2\hat{T}}}, \quad
    \hat\bm = \transpose{\br{\hat\rho, \hat\bv, \hat{T}}} \in \mathbb{R}^5,
\end{equation}
where vector \(\hat\bm\) is the solution of
\begin{equation}\label{eq:m_solution}
    \sum_j \bpsi_{\DV,j} \br{ \equil{f}_{\DV,j}(\hat\bm) - f_j } = 0, \quad
    \bpsi_j = \transpose{\br{1, \bxi_j,| \bxi_j|^2}} \in \mathbb{R}^5.
\end{equation}
For a uniform lattice in the velocity space,
it is proved that there exists a unique discrete equilibrium~\eqref{eq:equilibrium-bgk},
which is the maximization of the discrete entropy functional
and guarantees that mass, momentum, and kinetic energy are conserved~\cite{Mieussens2000}.
For computations, a finite number of discrete velocities is used: \(N = N_\DV < \infty\).
Note also that moments of~\eqref{eq:equilibrium-bgk} are not associated with \(\hat\bm\):
\begin{equation}\label{eq:equilibrium-bgk-moments}
    \sum_j \bpsi_{\DV,j} \equil{f}_{\DV,j}(\hat\bm) = \rho\transpose{\br{1, \bv, |\bv|^2 + 3T}}, \quad
    \bm = \transpose{\br{\rho, \bv, T}} \in \mathbb{R}^5.
\end{equation}
Vector \(\bm\) is not equal to \(\hat\bm\), but is quite close to it in practice,
when the velocity grid is well suited to the problem.

%%% Anisotropic velocity grids
When the velocity grid is anisotropic, the diagonal terms of the pressure tensor \(p_{\alpha\beta}\)
calculated from \(\equil{f}_{\DV,j}\) are not in general equal to each other.
Hence, the discrete equilibrium~\eqref{eq:equilibrium-bgk} has at least a direction-dependent momentum flux
\(p_{\alpha\beta}n_\alpha \neq \rho T n_\beta\) across an arbitrary interface with unit normal \(\bn\).
Thus, 5-moment Maxwellian~\eqref{eq:equilibrium-bgk} is sufficient to construct the conservative DV method
even for nonuniform anisotropic grids in the velocity space, but not for hybrid numerical method
based on coupling of DV approximations with different degrees of \(p_{\alpha\beta}\) anisotropy.
This anisotropy can be eliminated if the discrete equilibrium is constructed in the form
\begin{equation}\label{eq:equilibrium-bgk-aniso}
    \equil{f}_{\DV,j}(\hat\bm) = \hat{\rho} w_{\DV,j} \prod_\alpha\br{ 2\pi \hat{T}_\alpha }^{-1/2}
        \exp\br{-\sum_\alpha\frac{\br{\xi_{\DV\alpha,j}-\hat{v}_\alpha}^2}{2\hat{T}_\alpha}}, \quad
    \hat\bm = \transpose{\br{\hat\rho, \hat\bv, \hat{\bT}}} \in \mathbb{R}^7,
\end{equation}
where \(\xi_{\DV\alpha,j} \equiv \bxi_{\DV,j}\), vector \(\hat\bm\) is the solution of
\begin{equation}\label{eq:m_solution-aniso}
    \sum_j \bpsi_{\DV,j} \br{ \equil{f}_{\DV,j}(\hat\bm) - f_j } = 0, \quad
    \bpsi_j = \transpose{\br{1, \bxi_j, \bxi_j^2}} \in \mathbb{R}^7.
\end{equation}
The 7-moment Maxwellian~\eqref{eq:equilibrium-bgk-aniso} can also be obtained
from generalized minimum entropy principle~\cite{Charrier1999}.

%%% LB method
The \emph{LB method} can be considered as a special discretization of the BGK model~\cite{Succi2001}.
The investigated gas flow is assumed to be near-isothermal and slow,
i.e., the Mach number \(\Ma = |\bv|\) is close to zero and \(T = 1 + \OO{\Ma^2}\).
Under this restriction, the local Maxwell state is expanded into the Taylor series
in the bulk velocity \(\bv\) and perturbed temperature \((T-1)\)
around the absolute Maxwellian
\begin{equation}\label{eq:omega}
    \omega(\bxi) = \frac{1}{(2\pi)^{3/2}}\exp\br{ -\frac{\xi^2}{2} }, \quad \xi = |\bxi|
\end{equation}
with \(\rho=1\), \(\bv=0\), \(T=1\).
The resulting series is truncated to some finite order of \(\Ma\).
Particularly, the third-order expansion yields the following local equilibrium LB state:
\begin{equation}\label{eq:lbgk}
    \begin{aligned}
    \equil{f}_{\LB,j}(\bm) = \rho w_{\LB,j}\bigg( 1
        &+ \bxi_{\LB,j}\bdot\bv
        + \frac12\left[ (\bxi_{\LB,j}\bdot\bv)^2 - v^2 + (T-1)(\xi_{\LB,j}^2 - 3) \right] \\
        &+ \frac{\bxi_{\LB,j}\bdot\bv}6\left[ (\bxi_{\LB,j}\bdot\bv)^2 - 3v^2 + 3(T-1)(\xi_{\LB,j}^2-5) \right]
    \bigg), \quad j = 1,\ldots,N_\LB,
    \end{aligned}
\end{equation}
where the discrete velocities \(\bxi_{\LB,j}\) and the corresponding weights \(w_{\LB,j}\) satisfy the following relations:
\begin{equation}
    \sum_j w_{\LB,j} = 1, \quad \sum_j w_{\LB,j} \bxi_{\LB,j} = 0, \quad \sum_j w_{\LB,j} \xi_{\LB,j}^2 = 3,
\end{equation}
which secure the conservation laws.
However, truncating of type~\eqref{eq:lbgk} compromises the positivity condition in general
and, therefore, does not guarantee the entropy properties.

%%% Notation and particular cases
Hereinafter, a quadrature rule, based on \(\bxi_{\LB,j}\) and \(w_{\LB,j}\),
together with the discrete operator in form~\eqref{eq:lbgk},
is referred as the LB model.
Several approaches can be applied for the construction of LB models
like Gauss--Hermite~\cite{He1997, Shan1998, Shan2006, Shan2010}
and the entropic method~\cite{Karlin1999, Chikatamarla2006, Chikatamarla2009}.
The common notation D3Q\(p\) means \(N_\LB=p\) for the three-dimensional LB model.
The terms proportional to \((T-1)\) in~\eqref{eq:lbgk} vanish for isothermal LB models.
For low-order lattices, like D3Q19, the third-order terms are truncated in~\eqref{eq:lbgk}.

%%% Advantages of the LB method over the DV method
When the VDF is a slightly perturbed equilibrium,
it can be efficiently approximated using quadratures with small number \(N_\LB\).
The LB models are capable of reproducing low-order polynomial moments of the VDF accurately and,
therefore, describing a fluid-dynamic behavior of a gas, including that beyond the NS level.
Since the local LB equilibrium takes a polynomial form on the bulk velocity,
the conservation of mass, momentum and energy is achieved
with much less computational effort than for the conventional DV method.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Rogozin: We do not use this work, since we do not solve classical LBGK
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%We apply the kinetic boundary conditions (diffuse reflection)~\cite{Ansumali2002} for LB models in the present paper.

%%% Boundary conditions
The diffuse-reflection boundary condition~\eqref{eq:diffuse} is discretized as
\begin{equation}\label{eq:diffuse-dv}
    f_j(t,\bx_B) = -\frac{\sum_{\bxi_k\bdot\bn<0} \br{ \bxi_k\bdot\bn } f_k(t,\bx_B)}
        {\sum_{\bxi_k\bdot\bn>0} \br{ \bxi_k\bdot\bn } \equil{f}_k(\bm_B)}
        \equil{f}_j(\bm_B) \quad \br{ \bxi_j\bdot\bn>0 }, \quad \bm_B = \transpose{\br{1, \bv_B, T_B}},
\end{equation}
which preserves conservation of mass.

\section{The mapping method}\label{sec:mapping}

%%% Hermite expansion for transfering information between models
The mapping method between LB and DV models have to be introduced in the spatial overlapping zone
for the bidirectional transfer of information between subdomains with different types of discretization.
In the overlapping (or buffer) zone, the VDF is assumed to be close to~\eqref{eq:omega}
and, therefore, can be approximated by a three-dimensional Hermite expansion
truncated, in particular, to the third order:
\begin{equation}\label{eq:grad}
    \hermite{f}(t,\bx,\bxi) = \omega(\bxi)\br{ a(t,\bx)
        + \sum_{\alpha} \Aa(t,\bx) \Ha
        + \frac12 \sum_{\alpha,\beta} \Aab(t,\bx) \Hab
        + \frac16 \sum_{\alpha,\beta,\gamma} \Aabg(t,\bx) \Habg
    },
\end{equation}
where \(a, \Aa, \Aab, \Aabg\) are the first coefficients of the projection of the VDF onto the Hermite basis:
\begin{equation}\label{eq:a_coeffs}
    a = \int f\dxi, \quad \Aa = \int \Ha f\dxi, \quad \Aab = \int \Hab f\dxi, \quad \Aabg = \int \Habg f\dxi,
\end{equation}
and $\Ha, \Hab, \Habg$ are the Hermite polynomials of the first, second, and third order, respectively:
\begin{equation}\label{eq:Hermite_polynomials}
    \begin{gathered}
    \Ha(\bxi) = \frac{(-1)}{\omega(\bxi)}\pder{\xia}\omega(\bxi) = \xia, \quad
    \Hab(\bxi) = \frac{1}{\omega(\bxi)}\pderder{\xia}{\xib}\omega(\bxi) = \xia\xib - \delta_{\alpha\beta}, \\
    \Habg(\bxi) = \frac{(-1)}{\omega(\bxi)}\pderderder{\xia}{\xib}{\xig}\omega(\bxi)
        = \xia\xib\xig - \xia\delta_{\beta\gamma} - \xib\delta_{\alpha\gamma} - \xig\delta_{\alpha\beta},
    \end{gathered}
\end{equation}
where \(\delta_{\alpha\beta}\) is the Kronecker delta.

%%% Discretization
The discretization of the proposed mapping in the velocity space is straightforward:
the expansion coefficients~\eqref{eq:a_coeffs} are calculated as quadratures~\eqref{eq:cubature},
and the truncated Hermite expansion~\eqref{eq:grad} is approximated as
\begin{equation}\label{eq:discrete_grad}
    \hermite{f}_j = \equil{f}_j( \bm_0 ) \br{ a
        + \sum_{\alpha} \Aa \Ha(\bxi_j)
        + \frac12 \sum_{\alpha,\beta} \Aab \Hab(\bxi_j)
        + \frac16 \sum_{\alpha,\beta,\gamma} \Aabg \Habg(\bxi_j)
    },
\end{equation}
where \(\bm_0 = \transpose{\br{1, \boldsymbol{0}, 1}}\),
\(\equil{f}_{\LB,j}(\bm_0) = w_{\LB,j}\), which is seen from~\eqref{eq:lbgk},
and \(\equil{f}_{\DV,j}(\bm_0)\) is close to \(w_{\DV,j}\omega(\bxi_{\DV,j})\),
but not equal to it for the conservative DV method.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Rogozin: I commented out the following text as redundant.
%%%     In this section, the mapping method should be described only.
%%%     Details of the numerical algorithm should be given in section "Numerical method"
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% From LB to DV
% At the first step, we update the DV VDF $f_\DV(x,\bxi)$ for the discrete velocities $\bxi_n$
% such that $(\bxi_n,\be)<0$, where $\be$ is the outer normal to the overlapping zone.
% We start from the spatial nodes at the wall and move towards the overlapping zone.
% In the overlapping spatial domain (physical domain), we map the DV VDF on the Grad VDF
% by calculating the following coefficients:
% \begin{equation}
%     \begin{gathered}
%         a(x)=\sum_{m=1}^M f_\DV(x,\bxi_m), \quad
%         \Aa(x)=\sum_{m=1}^Mf_\DV(x,\bxi_m)\Ha(\bxi_m), \\
%         \Aab(x)=\sum_{m=1}^Mf_\DV(x,\bxi_m)\Hab(\bxi_m), \quad
%         \Aabg(x)=\sum_{m=1}^Mf_\DV(x,\bxi_m)\Habg(\bxi_m),
%     \end{gathered}
% \end{equation}
% where $\bxi_m, m=1 \ldots M$ are the velocities of the DV difference scheme.
% The Grad VDF \eqref{eq:grad} is recovered in the overlapping spatial domain.
%
% Next we will map~\eqref{eq:grad} on the LB distribution using the Gauss--Hermite quadrature method.
% The idea of the method is based on the fact that the representation of the VDF in the Grad form
% is equivalent to the LB method~\cite{He1997, Shan1998, Shan2006}.
% We consider the first moments $a,\Aa,\Aab,\Aabg$ in the integral form
% and then calculate them using Gauss--Hermite quadratures
% \begin{equation}
%     \{ a, \Aa, \Aab, \Aabg \}=\int f(\bxi)\{ 1, \Ha, \Hab, \Habg \}(\bxi)d\bxi =
%     \sum_{j=1}^N w_j\frac{f_H(\bc_j)}{\omega(\bc_j)} \{ 1, \Ha(\bc_j), \Hab(\bc_j), \Habg(\bc_j) \},
% \end{equation}
% where $w_j, \bc_j$ are the weights and the nodes of the Gauss--Hermite quadrature respectively.
% The nodes $\bc_j$ can be considered as the LB velocities,
% while $ w_j\frac{f(\bc_j)}{\omega(\bv_j)}$ are the LB VDF values
% and $w_j$ are the LB analog of the Maxwell distribution.
% Then the formula
% \begin{equation}\label{eq:grad_to_latt}
%     f_{\LB,j} = w_j\frac{f_H(\bc_j)}{\omega(\bc_j)}
% \end{equation}
% gives the mapping of $f_H$ to $f_{\LB,j}$ for the corresponding velocities $\bc_j$.
% Now having the values in the overlapping zone, we update $f_{\LB,j}$ for the velocities $\bc_j$
% directed from the overlapping zone into the interior of the LB domain.
%
% %%% From DV to LB
% The second step consists of the evaluation of the LB distribution for the lattice velocities $\bc_j$
% such that $(\bc_j,\be)<0$, where $\be$ is the outer normal to the overlapping zone.
% We evaluate the moments $a,\Aa,\Aab,\Aabg$ and finally update again the Grad VDF in the overlapping zone.
% The coefficients $a,\Aa,\Aab, \Aabg$ are calculated using the formulas
% \begin{equation}
%     a=\sum_{j=1}^N f_{\LB,j}, \quad
%     \Aa=\sum_{j=1}^N f_{\LB,j}\Ha(\bc_j), \quad
%     \Aab=\sum_{j=1}^N f_{\LB,j}\Hab(\bc_j), \quad
%     \Aabg=\sum_{j=1}^N f_{\LB,j}\Habg(\bc_j).
% \end{equation}
% Now we derive the DV VDF in the DV and LB overlapping zone.
% This can be made by a simple discretization of the Grad VDFs at the nodes of the DV scheme.
% Finally, we evaluate the DV VDF for the all velocities $(\bxi_j,\be)<0$
% in the interior of the DV spatial domain.

%%% Naturalness of the mapping method for Gauss--Hermite LB models
It is worth noting that the described mapping method is natural for the Gauss--Hermite LB models.
Specifically, if the order of truncation used in the Hermite expansion~\eqref{eq:grad}
coincides (or exceeds) with the order of the Gauss--Hermite LB model,
all nonequilibrium information that can be contained within this LB model
is transmitted unchanged through this Hermite-based mapping.
Nevertheless, this method can be used for the LB models
that are not derived on the basis of the Gauss--Hermite quadratures.
For instance, the nonequilibrium part of LB VDF can be projected onto the basis
spanned by Hermite polynomials after the regularization procedure~\cite{Latt2006, Chen2006}
and~\cite{Zhang2006, Mont2015, Mattila2017}.
Then the equivalence between the LB VDF and the expansion of type~\eqref{eq:grad} is achieved.

\section{Numerical method}\label{sec:numerics}

\subsection{Time-integration method}\label{sec:numerics:splitting}

%%% Splitting scheme
For the present study, we start from the simplest numerical algorithm providing the second-order accuracy
for both time and physical coordinates.
Equation~\eqref{eq:Boltzmann} is solved by the symmetric Strang's splitting scheme
\begin{equation}\label{eq:Strang}
    S^{\Delta{t}}_{A+B}(f_0) = S^{\Delta{t}/2}_A \br{S^{\Delta{t}}_B \br{S^{\Delta{t}/2}_A(f_0)} } + \OO{\Delta{t}^3},
\end{equation}
where \(A(f) = -\bxi\bdot\nabla{f}\), \(B(f) = J(f)/\tau\), \(\Delta{t}\) is the time step.
\(S^t_P(f_0)\) denotes the solution of the Cauchy problem
\begin{equation}\label{eq:Cauchy}
    \pder[f]{t} = P(f), \quad f|_{t=0} = f_0.
\end{equation}
Scheme~\eqref{eq:Strang} preserves the second-order accuracy if \(S^t_A\) and \(S^t_B\)
are approximated with the same convergence properties individually~\cite{Bobylev2001}.

%%% Solutions of individual problems
An important advantage of the splitting procedure is that the spatially homogeneous Boltzmann equation
has an exact solution for the BGK collision model:
\begin{equation}\label{eq:bgk_exact}
    S^t_B(f_0) = \equil{f} + \br{f_0-\equil{f}}\exp\br{-\frac\rho\tau t};
\end{equation}
however, the generalization to the original Boltzmann equation is straightforward.
For the collisionless Boltzmann equation, the desired second-order accuracy of \(S^t_A(f_0)\)
is archived by means of the finite-volume scheme described below.

%%% Steady-state solution
To find a steady-state solution of the boundary-value problem,
the time-marching process is started from some initial approximation
and continues until the convergence criterion is met.
For the DV method, the discrete equilibrium \(\equil{f}_{\DV,j}\) is obtained as a solution
of the nonlinear equations~\eqref{eq:m_solution} or \eqref{eq:m_solution-aniso} at each time step.
For this purpose, some root-finding algorithm should be harnessed.

\subsection{Finite-volume formulation}\label{sec:numerics:fv}

%%% General form
For the sake of simplicity, we consider a one-dimensional physical space
and introduce \(\xi = \xi_1\), \(x = x_1\).
Then, the collisionless Boltzmann equation with discrete velocities
\begin{equation}\label{eq:transport}
    \pder[f(\bxi_j)]{t} + \xi_j\pder[f(\bxi_j)]{x} = 0
\end{equation}
is approximated by the finite-volume (FV) method:
\begin{equation}\label{eq:finite_volume}
    f^{n+1}_m = f^n_m - \gamma_m\br{f^{n+1/2}_{m+1/2} - f^{n+1/2}_{m-1/2}}, \quad
    \gamma_m(\bxi_j) = \frac{\xi_j\Delta{t}}{\Delta{x_m}}, \quad
    m = 1,\dots,M, \quad n\in\mathbb{N},
\end{equation}
where \(\Delta{x_m}\) is the width of \(m\) cell in the physical space (\(\bx\in\mathbb{R}\)),
\(f^n_m(\bxi_j)\) denotes the fully discretized VDF defined in the cell centers:
\begin{equation}\label{eq:vdf_fv}
    f^n_m(\bxi_j) = f\br{
        t = t_n \equiv n\Delta{t}, \;
        x = x_m \equiv \frac{\Delta{x_m}}2 + \sum_{l=1}^{m-1}\Delta{x_l}, \;
        \bxi = \bxi_j
    }
\end{equation}
and \(f^{n+1/2}_{m+1/2}(\bxi_j)\) (\(m = 0,\dots,M\)) are the reconstructed edge values
defined at \(x_{m+1/2} = \sum_{l=0}^m\Delta{x_l}\).
The computational domain \(\Omega = [0,L]\), where \(L = x_{M+1/2}\), is extended by two ghost cells,
which are corresponded to \(m=0\) and \(m=M+1\) (Fig.~\ref{fig:fv_scheme}).
Hereinafter, we describe only positive velocities \(\xi_j>0\).
Fig.~\ref{fig:fv_scheme} shows a mesh with two ghost cells at each boundary.
For \(\xi_j<0\), all expressions are analogous
and can be obtained by the replacement \(\xi_j\to-\xi_j\) and \(x\to-x\).

\begin{figure}
    \centering
    \begin{tikzpicture}
        \fill[ghost] (-2,2) -- (0,2) -- (0,0) -- (-2,0) -- cycle;
        \draw[thick, line cap=round, step=2] (-2,0) grid (4,2);
        \foreach \i [evaluate={\x=\i-1}] in {1,3}
            \node[bolddot, label=above:$f^{n+1/2}_{\i/2}$] (F\i) at (\x,2) {};
        \foreach \i [evaluate={\x=2*\i-1}, evaluate={\a=2*(\i-1)}, evaluate={\b=2*\i}] in {0,1,2} {
            \node (f\i) at (\x,1) {$f^n_{\i}$};
            \draw[<->] (\a,-.5) -- (\b,-.5) node[above=-1pt, pos=0.5] {$\Delta{x}_{\i}$};
        };
        \foreach \x in {-2,0,2,4} \draw (\x,0) -- (\x,-.6);
        \draw[boundary=-45](0,2.2) -- (0,-.6) node[below] {$x=0$};
        \foreach \i [] in {0,1,2}
        \foreach \n in {f0,f1,f2} \draw[->, eqref] (\n) -- (F3);
        \foreach \n in {F1,f1} \draw[->, eqref] (\n) -- (f0);
        \draw[eqref,->] (F1) to [loop right, scale=2] (F1);
        \node at (f0) [eqref, below=4pt] {Eq.\eqref{eq:first_ghost}};
        \node at (F1) [eqref, above=8pt, right=4pt] {Eq.\eqref{eq:first_flux}};
        \node at (F3) [eqref, above=8pt, right=4pt] {Eq.\eqref{eq:internal_fluxes}};
        \useasboundingbox (-2.2,-1.1) rectangle (4.2,2.8);
    \end{tikzpicture}
    \begin{tikzpicture}
        \node {...};
        \useasboundingbox (-0.1,-2.1) rectangle (0.1,1.8);
    \end{tikzpicture}
    \begin{tikzpicture}
        \fill[ghost] (0,2) -- (2,2) -- (2,0) -- (0,0) -- cycle;
        \draw[thick, line cap=round, step=2] (-4,0) grid (2,2);
        \node[bolddot, label=above:$f^{n+1/2}_{M+1/2}$] (F) at (0,2) {};
        \foreach \idx/\i [evaluate={\x=2*\i-1}, evaluate={\a=2*(\i-1)}, evaluate={\b=2*\i}] in {M-1/-1,M/0,M+1/1} {
            \node (f\i) at (\x,1) {$f^n_{\idx}$};
            \draw[<->] (\a,-.5) -- (\b,-.5) node[above=-1pt, pos=0.5] {$\Delta{x}_{\idx}$};
        };
        \foreach \x in {-4,-2,0,2} \draw (\x,0) -- (\x,-.6);
        \draw[boundary=45](0,2.2) -- (0,-.6) node[below] {$x=L$};
        \foreach \n in {f-1,f0,f1} \draw[->, eqref] (\n) -- (F);
        \draw[->, eqref] (f-1) to[bend right] (f1);
        \draw[->, eqref] (f0) -- (f1);
        \node at (f1) [eqref, below=4pt] {Eq.\eqref{eq:last_ghost}};
        \node at (F) [eqref, below=8pt, right=8pt] {Eq.\eqref{eq:internal_fluxes}};
        \useasboundingbox (-4.2,-1.1) rectangle (2.2,2.8);
    \end{tikzpicture}
    \caption{
        The computational domain \(\Omega=[0,L]\) is extended by two ghost cells (shown in gray).
        The blue lines highlight the boundaries of \(\Omega\).
        The red arrows represent the dependency relations
        among the set of nodes in the extended \(\Omega\) for \(\xi_j>0\).
        The values in nodes pointed out by these arrows are calculated from the provided references.
    }
    \label{fig:fv_scheme}
\end{figure}

%%% Internal faces
The internal edge values can be written in the form
\begin{equation}\label{eq:internal_fluxes}
    f^{n+1/2}_{m+1/2} = f^n_m + \frac{1-\gamma_m}2\overline{Df^n_m}\Delta{x_m},
    \quad m = 1,\dots,M,
\end{equation}
where \(\overline{Df^n_m}\) is the limited approximation of \(\Pder[f]{x}(t_n, x_m, \bxi_j)\).
A monotonic-preserve scheme should be employed because sharp variations (in physical space)
of solution can occur even for nearly incompressible flow, especially for large \(|\bxi_j|\).
In the present paper, the third-order total variation diminishing (TVD) scheme is used
(see~\ref{sec:limiter} for details):
\begin{equation}\label{eq:limiter}
    \overline{Df^n_m} = \begin{cases}
        \min\br{
             \frac2{\gamma_m}\frac{|\Delta_-|}{h_-},
             \frac{1+\gamma_m}3\frac{|\Delta_-|}{h_-} + \frac{2-\gamma_m}3\frac{|\Delta_+|}{h_+},
             \frac2{1-\gamma_m}\frac{|\Delta_+|}{h_+}
        }\sgn\br{\Delta_-}, &\quad \Delta_+\Delta_- > 0, \\
        0, &\quad \Delta_+\Delta_- \leq 0,
    \end{cases}
\end{equation}
where
\begin{equation}\label{eq:differences}
    \Delta_\pm = \pm\br{f_{m\pm1}^n - f_m^n}, \quad h_\pm = \frac{\Delta{x_{m\pm1}} + \Delta{x_m}}2.
\end{equation}

%%% Boundary conditions
The outflow boundary condition are expressed in terms of edge values \(f^{n+1/2}_{M+1/2}(\bxi_j)\),
which are obtained from~\eqref{eq:internal_fluxes}
and the linear extrapolation for the ghost cell \(m=M+1\):
\begin{equation}\label{eq:last_ghost}
    f^n_{M+1} = 2f^n_M - f^n_{M-1}, \quad \Delta{x}_{M+1} = \Delta{x}_{M-1},
\end{equation}
which preserve the second-order accuracy~\cite{LeVeque2002}.
The inflow boundary condition are involved into the scheme
by means of \(f^{n+1/2}_{1/2}\) and \(f^{n+1/2}_{3/2}\).
In particular, the DV diffuse-reflection boundary condition~\eqref{eq:diffuse-dv} yields
\begin{equation}\label{eq:first_flux}
    f^{n+1/2}_{1/2}(\bxi_j) = -\frac{\sum_{\xi_k>0} \xi_k f^{n+1/2}_{1/2}(\bxi_k)}
        {\sum_{\xi_k<0} \xi_k \equil{f}_k(\bm_B)}
        \equil{f}_j(\bm_B).
\end{equation}
For the ghost cell \(m=0\), used for calculation \(f^{n+1/2}_{3/2}\) via~\eqref{eq:internal_fluxes},
the linear extrapolation of the form
\begin{equation}\label{eq:first_ghost}
    f^n_0 = \frac2{1+\gamma_1}f^{n+1/2}_{1/2} - \frac{1-\gamma_1}{1+\gamma_1}f^n_1, \quad
    \Delta{x}_0 = \Delta{x}_1
\end{equation}
also preserves the second-order accuracy, since it is a linear extrapolation of two values at \(t=t_n\):
\(f^n_1\) and \(f^{n+1/2}_{1/2} \equiv f(t_n+\Delta{t}/2, 0, \bxi_j) = f(t_n, -\gamma_1\Delta{x_1}/2, \bxi_j)\).
It is worth emphasizing that the presented numerical scheme for the boundary-value problem
possesses the second-order accuracy along with conservation of mass
(in contrast to the FV scheme used in~\cite{Baranger2019}).

%%% Stability
The maximum value of the time step \(\Delta{t}\) for the described explicit scheme
is limited by the Courant--Friedrichs--Lewy (CFL) condition:
\(\gamma_m(\bxi_j)\leq1\) for all \(m\) and \(j\), which is equivalent to
\begin{equation}\label{eq:CFL}
    \Delta{t} \leq \min_{m,j} \frac{\Delta{x_m}}{\xi_j}.
\end{equation}

%%% Why half-integer lattice?
The boundary conditions also dictate a way of discretization in the velocity space.
With respect to the origin of the velocity coordinates, only two types of lattices are symmetric~\cite{Inamuro1990}:
integer \(\br{\bxi_j/c_s} \in \mathbb{Z}^3\) and half-integer \(\br{\bxi_j/c_s + \be/2} \in \mathbb{Z}^3\),
where \(\be\) is the corresponding orthonormal basis.
For the considered boundary condition at \(x=0\), there is a zero-measure set of velocities
\(\Set{\bxi\in\mathbb{R}^3}{\xi_1=0}\), called tangential.
These velocities are immune to the boundary conditions.
The integer lattice contains a substantial subset of tangential velocities.
Therefore, to avoid an additional discretization error, the half-integer lattice is employed.

%%% Diffuse reflection for LB
In the same manner, LB quadratures without tangential velocities are preferable to the classical ones.
Moreover, LB models can be augmented by special groups of velocities to approximate
the diffuse-reflection boundary condition more accurately~\cite{Feuchter2016}.
These models ensure vanishing errors of the relevant half-space integrals.
Futhermore, the Gauss--Laguerre quadratures are able to reproduce the Maxwell half-range moments
exactly~\cite{Ambrus2014, Ambrus2016}.

\subsection{Coupling algorithm}\label{sec:numerics:coupling}

\begin{figure}
    \centering
    \begin{tikzpicture}
        \fill[ghost] (-4,2) -- (0,2) -- (0,0) -- (-4,0) -- cycle;
        \fill[ghost] (0,-1) -- (2,-1) -- (2,-3) -- (0,-3) -- cycle;
        \draw[thick, line cap=round, step=2] (-4,0) grid (4,2);
        \draw[thick, line cap=round, step=2, yshift=1cm] (-4,-4) grid (2,-2);
        \node[bolddot] (F_DV) at (0,2) {};
        \node[above] (F) at (F_DV.north) {$\tilde{f}^{n+1/2}_{1/2}$}
            edge [eqref, loop left] node {Eq.\eqref{eq:poly_correction}} ();
        \node[bolddot, label=above:$f^{n+1/2}_{3/2}$] (F_DV3) at (2,2) {};
        \node[bolddot, label=above:$f^{n+1/2}_{M+1/2}$] (F_LB) at (0,-1) {};
        \foreach \idx\i [evaluate={\x=2*\i-1}] in {M-1/-1,M/0,M+1/1} {
            \node (f_DV\i) at (\x,1) {$f^n_{\i}$};
            \node (f_LB\i) at (\x,-2) {$f^n_{\idx}$};
        };
        \node (f_DV2) at (3,1) {$f^n_2$};
        \draw[interface](0,2.2) -- (0,-0.2);
        \draw[interface](0,-.8) -- (0,-3.6) node[below] {$x=x_C$};
        \draw[->, interface] (-4,-3.5) node[above right] {LBM} -- (0,-3.5);
        \draw[<-, interface] (0,-3.5) -- (4,-3.5) node[above left] {DVM};
        \foreach \m in {LB,DV} \foreach \n in {f_\m-1,f_\m0,f_\m1} {
            \draw[->, eqref] (\n) -- (F_\m);
        }
        \foreach \m in {LB} \foreach \n in {f_\m-1,f_\m0,f_\m1} {
            \node at (F_\m) [eqref, below=8pt, right=8pt] {Eq.\eqref{eq:internal_fluxes}};
        }
        \foreach \m in {DV} \foreach \n in {f_\m-1,f_\m0,f_\m1} {
            \node at (F_\m) [eqref, above=8pt, right=4pt] {Eq.\eqref{eq:internal_fluxes}};
        }
        \foreach \m in {DV} \foreach \n in {f_\m0,f_\m1,f_\m2} {
             \draw[->, eqref] (\n) -- (F_\m3);
            \node at (F_\m3) [eqref, above=8pt, right=4pt] {Eq.\eqref{eq:internal_fluxes}};
        }
        \draw[->, mapping] (f_LB-1) -- (f_DV-1);
        \foreach \a/\b in {LB0/DV0,DV1/LB1}
            \draw[->, mapping] (f_\a) to[bend left=45] (f_\b);
        \foreach \n/\side/\offset in {f_DV-1/above/0,f_DV0.west/below right/1mm, f_LB1/below/0}
            \node at ($(\n) - (\offset,0)$) [eqref, \side=4pt] {Eq.\eqref{eq:discrete_grad}};
        \useasboundingbox (-4.2,-1.1) rectangle (2.2,2.8);
    \end{tikzpicture}
    \caption{
        The computational domain \(\Omega\) is divided into LB and DV subdomains,
        which are extended by the ghost cells (shown in gray).
        The vertical blue line highlight the coupling interface \(x=x_C\).
        The red arrows represent the dependency relations
        among the set of nodes in the extended \(\Omega\) for \(\xi_j>0\).
        The values in nodes pointed out by these arrows are calculated from the provided references.
        The dashed red arrows correspond to the projection of the solution onto the truncated Hermite basis.
    }
    \label{fig:coupling_scheme}
\end{figure}

%%% Domain decomposition
The mapping approach presented in Section~\ref{sec:mapping} can be implemented within the FV framework.
Let us divide our computational domain in the physical space into the LB and DV subdomains.
The coupling condition at the interface between these subdomains can be considered as a virtual boundary condition.
The concept of ghost cells provides the simplest (from the algorithmic point of view) coupling strategy.

%%% 1D example
Let us return to the one-dimensional case described in Sec.~\ref{sec:numerics:fv}
and suppose that \(x=x_C\) is the coordinate of the coupling interface,
\(x<x_C\) and \(x>x_C\) are covered by the LB and DV models, respectively (Fig.~\ref{fig:coupling_scheme}).
As before, only the positive velocities \(\xi_j>0\) are described.
Negative velocities \(\xi_j<0\) are treated in the same manner due to
symmetric coupling based on the unified DV representation in the velocity space.
In order to use~\eqref{eq:internal_fluxes} for calculating \(f^{n+1/2}_{1/2}(\bxi_{\DV,j})\)
and \(f^{n+1/2}_{3/2}(\bxi_{\DV,j})\),
the VDF should be mapped from LB to DV model in the ghost cells \(m=-1\) and \(m=0\).
Conversely, \(f^n_{M+1}(\bxi_{\LB,j})\) is reconstructed from \(f^n_1(\bxi_{\DV,j})\)
and substituted in~\eqref{eq:internal_fluxes} to obtain \(f^{n+1/2}_{M+1/2}(\bxi_{\LB,j})\).

%%% Conservative scheme
The proposed Hermite-based mapping method preserves all the conservation properties,
because all moments required for the equilibrium function are calculated exactly.
However, the FV scheme deals separately with velocities
directed in the opposite half-spaces with respect to the coupling interface.
For this reason, mass, momentum, and energy fluxes across the coupling interface
depend on quadrature rule and, therefore, are not exactly equal for the LB and DV models.
In the present study, the polynomial correction (like in~\cite{Aristov1980})
of the flux through the coupling interface is employed to recover the conservation properties.
Specifically, edge values \(f^{n+1/2}_{1/2}(\bxi_{\DV,j})\) are replaced by the corrected ones
\begin{equation}\label{eq:poly_correction}
    \tilde{f}^{n+1/2}_{1/2}(\bxi_{\DV,j}) = f^{n+1/2}_{1/2}(\bxi_{\DV,j}) \br{ 1 + \bm_C\bdot\bpsi_{\DV,j} }
        \quad (\xi_{\DV,j} > 0),
\end{equation}
where \(\bpsi_j\) is defined in~\eqref{eq:m_solution} and \(\bm_C\) is found from
\begin{equation}\label{eq:m_correction}
    \sum_{j=1}^{N_{\DV}} \xi_{\DV,j} \bpsi_{\DV,j} \tilde{f}^{n+1/2}_{\DV,j} =
        \sum_{j=1}^{N_{\LB}} \xi_{\LB,j} \bpsi_{\LB,j} f^{n+1/2}_{\LB,j}.
\end{equation}
The DV solution for negative velocities (\(\xi_{\DV,j} < 0\)) remains unchanged as well as the LB one.
In practice, each component of \(\bm_C\in\mathbb{R}^5\) is significantly less than unity;
therefore, the positivity is also preserved.

\subsection{Mesh refinement}\label{sec:numerics:refinement}

The diffuse-reflection boundary condition introduces several singularities into the VDF
both in the velocity space and in the physical one.
First, the discontinuity exists along the plane \(\bxi\bn=0\) and directly on the boundary surface (\(\bx=\bx_B\)).
For a convex domain, this discontinuity does not penetrate into the gas region~\cite{Kim2011, Guo2017},
since characteristics do not enter into the gas region.
Nevertheless, sharp variations of the solution near \(\bxi\bn=0\) requires a strong mesh refinement
in order to achieve a high-accuracy approximation.
Moreover, it is necessary to resolve the logarithmic singularity of the form~\cite{Takata2016}
\begin{equation}\label{eq:xi_singularity}
    \pder[f]{\bxi}\bdot\bn = C_1\log\bxi\bdot\bn + \OO{1}, \quad (\bxi\bdot\bn<0, \quad \bx=\bx_B).
\end{equation}
Second, another logarithmic singularity arises in the physical space along \(\bn\)~\cite{Takata2014}:
\begin{equation}\label{eq:x_singularity}
    \pder[f]{\bx}\bdot\bn = \frac{C_2}{k}\log\frac{(\bx-\bx_B)\bdot\bn}{k} + \OO{1}.
\end{equation}
Here, \(C_1\) and \(C_2\) are some positive constants.
It is seen from~\eqref{eq:x_singularity} that the logarithmic singularity of the VDF
--- and all macroscopic variables as well --- takes place for all Knudsen numbers;
however, for small \(k\), it becomes highly localized in the Knudsen layer.
Therefore, the physical mesh should be refined exponentially as \(\bx\) goes to \(\bx_B\).

\section{Results and discussion}\label{sec:results}

\subsection{Couette-flow problem}

%%% Couette-flow problem & benchmark
The proposed numerical method is tested for the plane Couette-flow problem,
where a gas is embraced between the two parallel plates with non-zero relative velocity.
The hybrid approach assumes that a highly nonequlibrium gas in the Knudsen layer
is described using the BGK equation, while the LB model is employed for the internal zone.
For the BGK model of the Boltzmann equation, the plane Couette-flow problem can be reduced
to a one-dimensional integral equation with a weakly singular kernel,
which has been solved accurately in~\cite{Luo2015} and, especially, in~\cite{Luo2016}.
Due to the lack of data on longitudinal heat flux in the mentioned works, we have re-implemented (in Python)
the adaptive collocation method based on the generalized Gauss quadratures presented in~\cite{Luo2016}
for computing the benchmark solutions (see~\ref{sec:benchmark_solution} for details).

%%% Physical mesh
Let the plates be placed at \(y = \pm 1/2\) with constant temperature \(T = 1\)
and velocities (\(\pm\Delta v/2,0,0\)), where \(\Delta v=0.02\),
which is small enough to consider the Couette-flow problem as linear.
A completely diffuse reflection is assumed at the plates.
The average density is equal to unity: \(\int_{-1/2}^{1/2}\rho dy=1\).
The physical space \(0 < y < 1/2\) is divided in two subdomains: \(0 < y < y_I\) and \(y_I < y < 1/2\).
The first one consists of identical cells,
while the nonuniform mesh in the second one refines as a geometrical sequence near \(y = 1/2\).
The total number of cells depends on \(k\) and varies from 28 to 35.

%%% Velocity grid
The VDF in the velocity space varies from discontinuous sum of two half-Maxwellians at the boundary
with complete diffuse-reflection condition to the near-equilibrium form in the vicinity of \(y=0\).
Such diversity can be efficiently approximated under the fixed DV set by employing
a significantly nonuniform velocity grid with local refinement near \(\xi_y=0\)~\cite{Ohwada1990, Wu2014, Rogozin2016}.
In the present paper, the nonuniform Cartesian lattice is cut off by the sphere of radius \(\xi^\cut=4\).
Along \(\xi_x\) and \(\xi_z\) axis, the nodes are distributed as the scaled roots of the Hermite polynomials:
\begin{equation}\label{eq:vgrid_hermite}
    \xiaj = x_{\Herm j} R, \quad w_{\alpha,j} = w_{\Herm j}\exp\br{x_{\Herm j}^2}R, \quad
    R = 2\xi^\cut \br{ \sum_{i=1}^{2N_{\alpha}} w_{\Herm i} \exp\br{x_{\Herm i}^2} }^{-1}, \quad
    j = 1,\dots,2N_{\alpha},
\end{equation}
where \(x_{\Herm j}\) and \(w_{\Herm j}\) are nodes and weights of the \((2N_{\alpha})\)-point Gauss--Hermite quadrature.
Along \(\xi_y>0\) semiaxis, the nodes are distributed as a polynomial (particularly, quadratic \(p=2\)) sequence:
\begin{equation}\label{eq:vgrid_polynomial}
    \xi_{y,j} = \sum_{i=0}^{j-1} \frac{w_{y,i} + w_{y,i+1}}2, \quad
    w_{y,j} = w_{y,1} + (j-1)^p \br{\xi^\cut - N_y w_{y,1}} \br{\sum_{i=0}^{N_y-1} i^p}^{-1}, \quad
    j = 1,\dots,N_y,
\end{equation}
where \(w_{y,0}=0\), \(w_{y,1}=0.1\) is the minimal width of cell in the velocity space.
The quarature weight in \(\mathbb{R}^3\) of discrete velocity \(\bxi_j\)
is equal to \(\prod_\alpha w_{\alpha,j}\).
For all the presented DVM solutions, \(N_{x/z}=8\) and \(N_y=16\) are chosen.
The discrete velocities with \(|\bxi_j| > \xi^\cut\) are excluded from the velocity grid;
therefore the total number of discrete velocities \(N_\DV=5928\).

%%% Preliminary discussion on longitudinal heat flux
Here it is important to mention that the longitudinal heat flux $q_x$ exists in the linear Couette-flow problem,
particularly, in the Knudsen layer only and, therefore, decays exponentially with the distance from the boundary~\cite{Sone2007}.
This heat flux is caused by the diffuse-reflection boundary condition and has non-polar singularity on $k$ at the boundary.
Hence, it cannot be reproduced by the Navier--Stokes or any other high-order fluid-dynamic-type equations
obtained from the Hilbert or Chapman--Enskog expansions.
Obviously, the classical LB models are unable to describe the Knudsen layer accurately and cope with \(q_x\) as a result.

\subsection{Numerical analysis}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{dvm}
        \caption{DV method}
        \label{fig:dvm}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{d3q19}
        \caption{LB method: D3Q19}
        \label{fig:d3q19}
    \end{subfigure}\\
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{d3q121}
        \caption{LB method: D3Q121}
        \label{fig:d3q121}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{d3v96}
        \caption{LB method: D3Q96}
        \label{fig:d3q96}
    \end{subfigure}
    \caption{
        Numerical solution of the Couette-flow problem for \(k=0.1\) obtained by pure DV or LB methods.
        The black lines are the high-accuracy solution for the BGK model.
        The black boxes correspond to the tabulated solutions~\cite{Luo2016}.
    }\label{fig:pure}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{hyb-d3q19}
        \caption{hybrid: DV and D3Q19}
        \label{fig:hyb:d3q19}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{hyb-d3v96}
        \caption{hybrid: DV and D3Q96}
        \label{fig:hyb:d3q96}
    \end{subfigure}
    \caption{
        Numerical solution of the Couette-flow problem for \(k=0.1\) obtained by the proposed hybrid method.
        There are \(1.2\) mean free paths between the boundary and coupling interface marked with the dash-dotted line.
        The black lines are the high-accuracy benchmark solution.
        The black boxes correspond to the tabulated values from~\cite{Luo2016}.
    }\label{fig:hybrid}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{d3q19-k0_03}
        \caption{LB method: D3Q19}
        \label{fig:d3q19-k0_03}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{d3v96-k0_03}
        \caption{LB method: D3Q96}
        \label{fig:d3q96-k0_03}
    \end{subfigure}\\
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{hyb-d3q19-k0_03}
        \caption{hybrid: DV and D3Q19}
        \label{fig:hyb:d3q19-k0_03}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{hyb-d3v96-k0_03}
        \caption{hybrid: DV and D3Q96}
        \label{fig:hyb:d3q96-k0_03}
    \end{subfigure}
    \caption{
        Numerical solution of the Couette-flow problem for \(k=0.03\) obtained by the proposed hybrid method.
        There are \(3\) mean free paths between the boundary and coupling interface marked with the dash-dotted line.
        The black lines are the high-accuracy benchmark solution.
        The black boxes correspond to the tabulated values from~\cite{Luo2016}.
    }\label{fig:k0_03}
\end{figure}

\begin{figure}
   \centering
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{d3q19-k0_3}
       \caption{LB method: D3Q19}
       \label{fig:d3q19-k0_3}
   \end{subfigure}%
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{d3v96-k0_3}
       \caption{LB method: D3Q96}
       \label{fig:d3q96-k0_3}
   \end{subfigure}\\
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{dvm-k0_3}
       \caption{DV method}
       \label{fig:dvm-k0_3}
   \end{subfigure}%
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{hyb-d3q19-k0_3}
       \caption{hybrid: DV and D3Q19}
       \label{fig:hyb:d3q19-k0_3}
   \end{subfigure}\\
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{hyb-d3q121-k0_3}
       \caption{hybrid: DV and D3Q121}
       \label{fig:hyb:d3q121-k0_3}
   \end{subfigure}%
   \begin{subfigure}[b]{0.5\textwidth}
       \includegraphics[width=\textwidth]{hyb-d3v96-k0_3}
       \caption{hybrid: DV and D3Q96}
       \label{fig:hyb:d3q96-k0_3}
   \end{subfigure}
   \caption{
       Numerical solution of the Couette-flow problem for \(k=0.3\) obtained by the proposed hybrid method.
       There are \(0.8\) mean free paths between the boundary and coupling interface marked with the dash-dotted line.
       The black lines are the high-accuracy benchmark solution.
       The black boxes correspond to the tabulated values from~\cite{Luo2016}.
   }\label{fig:k0_3}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{shear-k0_3}
        \caption{\(k=0.3\), \(p^\mathrm{(ex)}_{xy} = -0.1868996702\)}
        \label{fig:accuracy-k0_3}
    \end{subfigure}%
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{shear-k0_1}
        \caption{\(k=0.1\), \(p^\mathrm{(ex)}_{xy} = -0.08311215565\)}
        \label{fig:accuracy-k0_1}
    \end{subfigure}%
    \begin{subfigure}[b]{0.33\textwidth}
        \includegraphics[width=\textwidth]{shear-k0_03}
        \caption{\(k=0.03\), \(p^\mathrm{(ex)}_{xy} = -0.02827597203\)}
        \label{fig:accuracy-k0_03}
    \end{subfigure}
    \caption{
        Absolute numerical error of the shear stress obtained by the pure and hybrid schemes.
        The dash-dotted lines correspond to the coupling interface used for the domain decomposition.
        The reference values \(p^\mathrm{(ex)}_{xy}\) are taken from~\cite{Luo2016}.
    }\label{fig:accuracy}
\end{figure}

%%% Pure DV and LB results
The numerical results obtained by the pure DV and LB methods for \(k=0.1\) are showed in Fig.~\ref{fig:pure}.
The nonuniform velocity grid refined at the sharp variations of the VDF
yields a very small discrepancy between the DV and benchmark profiles (Fig.~\ref{fig:dvm}).
As for LB method, in the present paper, the 5-order D3Q19 model and 9-order D3Q121 model~\cite{Shan2010}
based on the Gauss--Hermite quadratures are considered, along with special 7-order D3Q96 model
developed for the boundary-value problems driven by the diffuse-reflection boundary condition~\cite{Feuchter2016}.
Ability to capture rarefied-gas effects arising from the kinetic boundary conditions
is clearly observed from the profile of the longitudinal heat flux \(q_x\).
In particular, models of the Navier--Stokes level do not capture it due to lack of additional degrees of freedom,
e.g., the D3Q19 model does not cover the third-order moments of the VDF (Fig.~\ref{fig:d3q19}).
Instead, there is a small spurious positive heat flux in Fig.~\ref{fig:d3q19},
which is \(\OO{\Delta v^3}\) and closely associated with the stress tensor and velocity.
The model D3Q121 describes the heat flux in the continuum zone most accurately (Fig.~\ref{fig:d3q121}),
while the D3Q96 profile is quite close to the exact one in the Knudsen layer (Fig.~\ref{fig:d3q96}).

%%% Why D3Q96 is better than D3Q121
Increasing order of the LB model helps to capture the corresponding low-order moments of the VDF,
but failed to describe its high-order relaxation correctly.
However, the LB models augmented by special groups of velocities are capable to reproduce the Knudsen layer to some extent.
The augmented model D3Q96 reproduces the Maxwell half-range (or wall) moments better than D3Q121,
which results in better reproduction of the diffuse-reflection boundary condition.
As a result, D3Q96 produces qualitatively correct results for the longitudinal heat flux,
which has non-thermo-hydrodynamical nature, although does not recover thermo-hydrodynamics.

%%% Hybrid results
The numerical results for the hybrid schemes are shown in Fig.~\ref{fig:hybrid}.
Quantities \(v_x\) and \(p_{xy}\) are close to the exact solution,
but there is a noticeable distortion behind the coupling interface in the D3Q19 velocity profile.
Hybrid \(q_x\) is close to the pure DV one only in the kinetic region (the DV part of the hybrid solution).
There are small oscillations of macroscopic variables in the buffer zone,
and they are particularly noticeable for \(q_x\), since its profile is multiplied by factor 40.
The amplitude of these oscillations is proportional to the high-order terms of the Hermite expansion of the VDF
that are not included the employed mapping method.
These terms decrease exponentially as the coupling interface moves away from \(y=1/2\).
The numerical results for \(k=0.03\) shown in Fig.~\ref{fig:k0_03},
where 3 mean free paths (in contrast to 1.2 for \(k=0.1\)) are covered by DV method, clearly illustrate this fact.

%%% Case k=0.3
For larger Knudsen numbers, the advantage of the DV method over the LB one in terms of accuracy becomes more evident,
since rarefied-gas effects amplify considerably (Fig.~\ref{fig:k0_3}).
The D3Q19 model loses its accuracy most of all:
there is a large deviation from the benchmark profiles of \(p_{xy}\) and \(v_x\) in Fig.~\ref{fig:d3q19-k0_3}.
Despite the fact that D3Q96 is able to reproduce half-range (wall) moments most accurately within the given order,
it fails to reproduce the complex structure of a highly nonequlibrium VDF with sharp variations
around plane \(\xi_y=0\) (Fig.~\ref{fig:d3q96-k0_3}).
In contrast, the DV method with velocity grid refined near \(\xi_y=0\) fully copes with this task.
One cannot conclude the same for the results obtained by hybrid schemes.
There is a noticable error for \(q_x\) and a kink for \(v_x\) in Fig.~\ref{fig:hyb:d3q19-k0_3}--\subref{fig:hyb:d3q96-k0_3}.
The proximity of the coupling interface to the boundary in terms of mean free path is the primary reason
for the observed lack of accuracy. Note also that hybrid method based on the D3Q96 model has a minimal kinking
of the velocity profile in comparison to D3Q19 and D3Q121.

%%% Accuracy of results
The shear stress profiles look constant in Figs.~\ref{fig:hybrid},~\ref{fig:k0_03} and~\ref{fig:k0_3},
since the absolute error is everywhere smaller than \(0.06k^2\), which is easily seen in Fig.~\ref{fig:accuracy}.
The largest error is observed in the points in the vicinity of the coupling interface.
In the absence of conservative correction of fluxes on the coupling interface~\eqref{eq:poly_correction},
these oscillations turn into monotonic jumps, which introduce much more error into results.
This fact clearly confirms the well-known importance of preserving the conservation properties by a numerical method.
Incidentally, let us note that the obtained numerical accuracy is sufficient
to distinguish molecular potentials~\cite{Sharipov2013, Su2018}.

%%% [Aristov]: We compared our results with available data on the benchmark problem [Phys. Fluids 25, 027101 (2013)] devoted to the computation ab initio by DSMC for the Couette flow problem. In [1] for U/u0=0.2 the values for comparison of only the shear stress are given (the temperature and the velocity gradient are not presented). These results ab initio are compared with the analogous calculations for HS and from Table IV in [1] one can see that the relative difference is of 0.3% (the column concerning C=0 or C=1). Our value of the shear stress for the hybrid scheme is 0.83 and differs from the tabulated values for the Couette flow is of the same order, namely 0.3%. So we conclude that the difference between the hybrid shear stress results and the value of the benchmark results ab initio is in the range of the computational error.

%%% Efficiency
Finally, let us touch upon the efficiency of the proposed hybrid scheme.
The computational speed-up with respect to the pure DV scheme is shown in Fig.~\ref{fig:speed-up} as a ratio of the corresponding CPU times,
while the ratio of cells in the kinetic and bulk regions remains constant.
One can see that efficiency of the hybrid method achieves the optimum value when number of cells in the kinetic region is more than $10^2$.
Note that the asymptotic speed-up can be slightly higher than the optimum one (12--13 versus 11 in Fig.~\ref{fig:speed-up}).
It is mainly due to memory saving, which results in fewer cache misses.

\subsection{Breakdown criterion}

\begin{figure}
    \centering
    \includegraphics[width=0.6\textwidth]{acceleration}
    \caption{
        Computational speed-up yielded by the hybrid method for different CPUs and operational systems.
        $N_0$ is the number of cells in the kinetic zone, $10N_0$ is the number of cells in the bulk region,
        $t_\DV$ and $t_\mathrm{hyb}$ are the total CPU times elapsed by the DV and hybrid methods, respectively.
    }\label{fig:speed-up}
\end{figure}

\begin{figure}
    \centering
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{norms-dvm}
        \caption{DV method}
        \label{fig:norms:dvm}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{norms-d3v96}
        \caption{LB method: D3Q96}
        \label{fig:norms:d3q96}
    \end{subfigure}\\
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{norms-hyb-d3q19}
        \caption{hybrid: DV and D3Q19}
        \label{fig:norms:d3q19-hyb}
    \end{subfigure}%
    \begin{subfigure}[b]{0.5\textwidth}
        \includegraphics[width=\textwidth]{norms-hyb-d3v96}
        \caption{hybrid: DV and D3Q96}
        \label{fig:norms:d3q96-hyb}
    \end{subfigure}
    \caption{
       Quantities that can serve as a equilibrium breakdown parameter for \(k=0.1\).
    }\label{fig:norms}
\end{figure}

%%% Breakdown criterion and adaptive algorithm
A multiscale hybrid method based on the domain decomposition procedure should be supplied
with the so-called equilibrium breakdown criterion, which determines the position of the coupling interface
between different models for approximation of the VDF. The common way to quantify this criterion is
to introduce an appropriate equilibrium breakdown parameter \(E\) and compare it with some predefined value \(\epsilon_E\).
The DV method is used only in nonequlibrium regions, specifically in cells, where \(E>\epsilon_E\),
while the LB method is employed in the others.

%%% Breakdown parameters
Longitudinal heat flux \(q_x\) appears only in the Knudsen layer and, therefore, can serve as an equilibrium breakdown parameter
for the investigated Couette-flow problem, but not in the general case.
Criteria based on deviation of the VDF from the truncated Chapman--Enskog expansion is natural for kinetic schemes.
For instance, quantities \(E_p=\|f-\NSF{f}\|_p/\|f\|_p\),
the deviation from the Navier--Stokes--Fourier (NSF) order of approximation~\cite{Zhang2014}:
\begin{gather}
    \NSF{f}_{\DV,j} = \equil{f}_{\DV,j}\br{
        1 + \frac{\caj\cbj P_{\alpha\beta}}{2pT} + \frac{\caj q_\alpha}{pT}\br{ \frac{c_j^2}{5T} - 1 } }, \label{eq:NSF_DV} \\
    \NSF{f}_{\LB,j} = \equil{f}_{\LB,j} + w_j\xiaj\br{
         P_{\alpha\beta}\br{\xibj\br{1 + \xigj v_\gamma} - 2 v_\beta } + q_\alpha\br{ \frac{\xi_j^2}5 - 1 } }, \label{eq:NSF_LB}
\end{gather}
where \(P_{\alpha\beta} = p_{\alpha\beta} - \rho T\delta_{\alpha\beta}\) and \(\caj = \xiaj - v_\alpha\),
are shown in Fig.~\ref{fig:norms} for the following norms in the discrete velocity space:
\begin{equation}\label{eq:norms}
    \|f\|_p = \bigg(\sum_j |f_j|^p \bigg)^{1/p}, \quad p=1,2, \quad \|f\|_\infty = \max_j |f_j|.
\end{equation}

%%% Discussion on figures
The D3Q19 model produces an almost constant profile (Fig.~\ref{fig:norms:d3q19-hyb}),
since it describes nothing beyond the NSF level.
The D3Q96 profile (Fig.~\ref{fig:norms:d3q96}) is close to the DV one (Fig.~\ref{fig:norms:dvm}),
which indirectly indicates that this LB model gives an acceptable approximation for the Couette-flow problem.
Due to the diffuse-reflection boundary condition, there is a discontinuity of the VDF on the boundary,
which decays monotonically and faster than any inverse power of distance from the boundary.
Therefore, all the breakdown parameters reach their maximum on the boundary;
however, \(E_\infty\) relaxes in a non-smooth way.
This is probably due to crude approximation of the sharp variations of the VDF in the Knudsen layer.
For the D3Q96 model, \(E_\infty\) noticeably exceeds \(E_{1,2}\) (Fig.~\ref{fig:norms:d3q96}),
which can be explained by its peculiar properties minimizing the wall moment errors.
The Hermite-based coupling induces oscillations (Fig.~\ref{fig:norms:d3q19-hyb},~\ref{fig:norms:d3q96-hyb}),
since it is unable to reconstruct nonequilibrium part of the VDF.
The sharp drop in Fig.~\ref{fig:norms:d3q19-hyb} indicates that the coupling interface is too close to the boundary,
while the smoother transition in Fig.~\ref{fig:norms:d3q96-hyb} can be considered as more acceptable.
Nevertheless, both hybrid schemes have almost the same DV part of the solution.

\begin{comment}% [POISEUILLE]

\begin{figure}
    \centering
    \includegraphics[width=.7\textwidth]{_pois_hybr_kn01_cropped}
    \caption{
        The normalized longitudinal velocity in the linear force-driven Poiseuille flow between parallel plates for $k=0.1$.
        The position of the coupling interface are shown by the vertical dashed lines.
    }\label{fig:poiseuille}
\end{figure}

%%% Poiseuille flow
In addition, the linear Poiseuille-flow problem is solved numerically.
The hybrid solution is compared with the DV and LB ones in Fig.~\ref{fig:poiseuille},
where the D2Q9-regularized LB model is employed~\cite{Latt2006, Mont2015}.
The hybrid solution based on the D2Q9-regularized model is very close to the DV results,
while the D2Q9-regularized model is failed to capture the Knudsen-layer part of the solution.
It is clearly seen from Fig.~\ref{fig:poiseuille} that the application of the regularized LB models in the hybrid scheme
can positively affect the solution accuracy in comparison to the conventional LB models.

\end{comment}

\section{Conclusions and perspectives}\label{sec:summary}

%%% What have we done?
In this paper, we have presented a new algorithm for coupling of the DV numerical solutions of the BGK kinetic equation.
The mapping method is based on the Hermite expansion of the VDF.
For the continuum region, we have employed various Gauss--Hermite LB models with different numbers of discrete velocities ranging from 9 to 121.
Incorporating the augmented~\cite{Feuchter2016} LB models % [POISEUILLE]: and regularized~\cite{Latt2006, Mont2015}
positively affect the solution accuracy in comparison to the conventional LB models.
Additional correction procedures have been applied to ensure conservative properties of the hybrid algorithm.
The influence of the breakdown criterion on accuracy and efficiency has also been studied.
The regularized high-order LB models for the hybrid schemes are of interest for further study.

%%% Adaptive mesh in velocity space
A number of problems can be addressed through further study.
A significant number of discrete velocities used for approximation of the VDF is somewhat overkill,
since the highest moments are unimportant for many flows.
Therefore, adaptation of the DV set according to the local flow regime provides room for improving the efficiency of numerical methods
and can serve as a foundation of hybrid schemes for compressible flows.
This approach is similar to the adaptive schemes in velocity space~\cite{Aristov1977, Kolobov2013, Baranger2014}.
%%% Ilyin: applicability of our method
The present scheme can be extended to non-negligible $\Ma$ flows. Since the applied high-order LB model reproduces isothermal hydrodynamics exactly, the method can be applicable to the flows with $\Ma \sim 0.1-0.3$.

%%% Other LB models
The other LB models (e.g., for supersonic flows, compressible and thermal flows~\cite{Chen2010, Frapolli2015, Frapolli2016})
can be incorporated in the proposed hybrid method.
The entropic models are promising due to their enhanced stability for low viscosities (large Reynolds numbers).

% We emphasize that LB is less computationally demanding than DV method. On the other hand, conventional LB is aimed to reproduce only the lowest moments of VDF in slow regimes whereas DV is able to cope with strong nonequilibrium effects.

%%% TODO(olegrog): rework from discussion to future
One can conclude that the improvements in LB method should be directed
to the better reproduction of the higher Maxwell moments and half-range (wall) moments as well.
In this case, the mapping method can be improved by involving fourth-order moments
and including the enhanced LB models.

\section*{Acknowledgements}

This work was supported by the Russian Foundation for Basic Research (Grants 18-01-00899, 18-07-01500).
The authors are grateful to referees for many constructive comments improving the quality of the paper.

\appendix

\section{Third-order TVD limiter}\label{sec:limiter}

Let us approximate the one-dimensional transport equation \(\Pder[f]{t} + \xi\Pder[f]{x}\)
in the FV manner with constant mesh (\(\Delta{x}\)) and time (\(\Delta{t}\)) steps:
\begin{equation}\label{eq:fv:scheme}
    f^{n+1}_m = f^n_m - \gamma\br{f^{n+1/2}_{m+1/2} - f^{n+1/2}_{m-1/2}}, \quad
    \gamma = \frac{\xi\Delta{t}}{\Delta{x}} \geq 0, \quad
    m = 1,\dots,M, \quad n\in\mathbb{N},
\end{equation}
where the reconstructed edge values for the third-point stencil are written in the following form:
\begin{equation}\label{eq:fv:flux}
    f^{n+1/2}_{m+1/2} = f^n_m + \frac{1-\gamma}2\phi\br{\frac{\Delta_-}{\Delta_+}}\Delta_+, \quad m = 1,\dots,M,
\end{equation}
where \(\Delta_\pm = \pm\br{f^n_{m\pm1} - f^n_m}\), function \(\phi(\theta)\) is usually called a flux limiter.
Within the one-point stencil for positive velocities \(\xi_j>0\),
it is possible to construct the first-order (upwind) scheme only (\(\phi=0\)).
The second-order accuracy can be achieved, if \(\phi(1+x) = 1 + \OO{x}\).
For the third-order accuracy, the following condition is sufficient:
\begin{equation}\label{eq:fv:third_order}
    \phi(1+x) = 1 + \frac{1+\gamma}3x + \OO{x^2}.
\end{equation}
Taking into account the CFL condition \(\gamma\leq1\)
and non-negativity of the limiter for monotonic functions \(\phi(\theta\geq0)\geq0\),
one can obtain the following sufficient conditions for the TVD property of the numerical scheme:
\begin{equation}\label{eq:fv:tvd}
    \begin{cases}
        \phi(\theta) = 0, \quad \theta < 0, \\
        \phi(\theta) \leq \dfrac{2}{\gamma}\theta, \quad \theta \geq 0, \\
        0 \leq \phi(\theta) \leq \dfrac2{1-\gamma}.
    \end{cases}
\end{equation}
Combining~\eqref{eq:fv:third_order} and~\eqref{eq:fv:tvd}, one can construct a third-order TVD limiter:
\begin{equation}\label{eq:fv:limiter}
    \phi(\theta) = \begin{cases}
        0, &\quad \theta < 0, \\
        \min\br{ \dfrac{2}{\gamma}\theta, \dfrac{1+\gamma}3\theta + \dfrac{2-\gamma}3, \dfrac2{1-\gamma}},
            &\quad \theta \geq 0,
    \end{cases}
\end{equation}
which is used in the present study, but for nonuniform mesh step~\eqref{eq:limiter}.
Let us note that inequalities~\eqref{eq:fv:tvd} are often replaced by stronger ones, independent of \(\gamma\),
especially when nonlinear transport equation is considered.

\section{Benchmark solution of the Couette-flow problem}\label{sec:benchmark_solution}

%%% Formulation of the linear Couette-flow problem
For symmetry reasons, the steady-state behavior of the gas in the Couette flow at \(\Delta{v}\to0\)
and arbitrary \(k\) is described by the following VDF:
\begin{equation}\label{eq:exact:vdf}
    f(\bxi) = \omega(\bxi)\br{ 1 + \Delta{v}\xi_x \Phi(y, \xi_y, \xi) }, \quad \xi = |\bxi|,
\end{equation}
where \(\omega(\bxi)\) is defined in~\eqref{eq:omega} and \(\Phi\) is governed by
\begin{equation}\label{eq:exact:Phi}
    \tau\xi_y\pder[\Phi]{y} = \frac{v_x}{\Delta{v}} - \Phi, \quad\
    \Phi\br{ y=\mp\frac12, \xi_y\gtrless0, \xi } = \mp\frac12,
\end{equation}
which is derived under the assumption of the BGK model of collisional term~\cite{Sone2007}.
The macroscopic variables are the following moments of \(\Phi\):
\begin{equation}\label{eq:exact:macro}
    v_x = \Delta{v}\int \xi_x^2\Phi\omega\dd\xi, \quad
    p_{xy} = \Delta{v}\int \xi_x^2\xi_y\Phi\omega\dd\xi, \quad
    q_x = \frac{\Delta{v}}2 \int \xi_x^2\xi^2\Phi\omega\dd\xi - \frac52v_x.
\end{equation}

%%% Solution
The solution of~\eqref{eq:exact:Phi} can be represented as
\begin{equation}\label{eq:exact:Phi_explicit}
    \Phi\br{ |y| \leq \frac12, \xi_y\gtrless0, \xi } = \mp\frac12\exp\br{ \mp\frac{1\pm2y}{2\tau\xi_y} } +
        \frac1{2\tau\xi_y} \int_{\mp\frac12}^y \exp\br{ -\frac{y-s}{\tau\xi_y} } g(s)\dd{s} ,
\end{equation}
where \(g(y) = 2v_x/\Delta v\) is obtained from the following integral equation~\cite{Willis1962}:
\begin{equation}\label{eq:exact:g}
    \sqrt{\pi} g(y) = \mathcal{J}_0 \left(\frac{1-2y}{2k}\right) - \mathcal{J}_0 \left(\frac{1+2y}{2k}\right)
        + \frac1k \int_0^{\frac12} \left[ \mathcal{J}_{-1}\left(\frac{|y-s|}{k}\right)
        - \mathcal{J}_{-1}\left(\frac{y+s}{k}\right) \right] g(s) \dd{s}.
\end{equation}
Here, \(\mathcal{J}_n(s)\) are the Abramowitz functions~\cite{Abramowitz1972}:
\begin{equation}\label{eq:exact:Abramowitz}
    \mathcal{J}_n(s) = \int_0^\infty t^n \exp\br{ -t^2-\frac{s}{t} } \dd t,
    \quad s\ge0, \quad n \in \mathbb{Z}.
\end{equation}
The remaining macroscopic variables are calculated as follows:
\begin{gather}
    \frac{p_{xy}}{\Delta v} = -\frac{\tau}{\sqrt{\pi}} \br{
        \mathcal{J}_2(0)-\mathcal{J}_2\left(\frac1k\right)
        + \frac1k\int_0^{\frac12}\left[
            \mathcal{J}_1\left(\frac{1-2s}{2k}\right)-\mathcal{J}_1\left(\frac{1+2s}{2k}\right)
        \right]g(s)\dd{s}
    }, \label{eq:exact:Pxy} \\
    \begin{aligned}
    \frac{q_x}{\Delta v} = \frac1{2\sqrt{\pi}} & \left(\vphantom{\int_0^{\frac12}}
        \mathcal{J}_2\br{ \frac{1-2y}{2k} } - \mathcal{J}_2\br{ \frac{1+2y}{2k} }\right. \\
        &+\left. \frac1k\int_0^{\frac12}\left[
            \mathcal{J}_1\br{ \frac{|y-s|}k } - \mathcal{J}_1\br{ \frac{y+s}k }
        \right]g(s)\dd{s}
    \right) - \frac{g(y)}4.
    \end{aligned} \label{eq:exact:qflow}
\end{gather}

\bibliography{dvm-lbm}

\end{document}
